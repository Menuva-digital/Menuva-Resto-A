<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}

  </style>
</head>
<body>

  <div class="menuva-logo">
    <img src="menuva-logo.png" alt="Logo Menuva">
  </div>

  <div class="section">
    <h2>📇 Identitas Restoran</h2>
    <input type="file" id="logoInput" accept="image/*" />
    <img id="previewLogo" src="" alt="Logo Restoran" style="max-height: 80px; margin-top: 10px;" />
    <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
  </div>

  <div class="section">
    <h2>📋 FOOD MENU</h2>
    <div id="menuFoodContainer"></div>
    <button class="btn-success" onclick="tambahMenu('food')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>📋 SNACK & DESSERT</h2>
    <div id="menuSnackContainer"></div>
    <button class="btn-success" onclick="tambahMenu('snack')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>📋 DRINK</h2>
    <div id="menuDrinkContainer"></div>
    <button class="btn-success" onclick="tambahMenu('drink')">+ Tambah Menu</button>
  </div>
  
  <h3>📱 Nomor WhatsApp Admin (Penerima Pesanan/Reservasi)</h3>
  <div id="nomorWaContainer">
  <input type="text" class="nomor-wa" placeholder="Contoh: 6281234567890">
  </div>
  <button onclick="tambahNomorWa()">Tambah Nomor WA</button>


  <div class="section">
    <h2>📸 Galeri Ruangan</h2>
    <input type="file" id="flipbookRuanganUpload" accept="image/*" multiple />
    <div id="flipbookRuanganPreview" class="preview"></div>
  </div>

  <div class="section">
    <h2>📖 Menu Restoran</h2>
    <input type="file" id="flipbookMenuUpload" accept="image/*" multiple />
    <div id="flipbookMenuPreview" class="preview"></div>
  </div>

  <div class="section">
    <button onclick="simpanData()">💾 Simpan Semua</button>
    <button onclick="window.open('menu.html')" style="margin-top: 10px;">👁️ Lihat Halaman Customer</button>
    <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: orange; color: white; padding: 10px; border: none; border-radius: 8px; margin-top: 10px;">
      📋 Salin Link menu.html
    </button>
    
    <!-- Backup dan Restore -->
<div class="section">
  <h2>🔁 Backup & Restore Data</h2>
  <button onclick="backupData()" class="btn-orange">⬇️ Backup Data</button>
  <input type="file" id="restoreInput" accept=".json" />
  
  <div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
    <strong>Panduan Penggunaan:</strong><br>
    PENTING!!<br>
    🔹 Klik <strong>⬇️ Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
    🔹 Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
    🔹 Klik <strong>📂 Pilih File</strong untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
    ⚠️ Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
    💡 Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
  </div>
</div>

    <button onclick="window.location.href='index.html'" class="btn-secondary" style="margin-top: 10px;">🔒 Logout</button>
    <button onclick="resetData()" class="btn-danger" style="margin-top: 10px;">🗑️ Reset Semua Data</button>
  </div>
  
<script>
  let flipbookRuanganImages = [];
  let flipbookMenuImages = [];

  function tambahMenu(kategori = 'food', nama = '', harga = '') {
    const containerId = {
      food: 'menuFoodContainer',
      snack: 'menuSnackContainer',
      drink: 'menuDrinkContainer'
    }[kategori];

    const container = document.getElementById(containerId);
    const div = document.createElement('div');
    div.className = 'menu-item';
    div.innerHTML = `
      <input type="text" placeholder="Nama Menu" value="${nama}" />
      <input type="number" placeholder="Harga" value="${harga}" />
      <select>
        <option value="food" ${kategori === 'food' ? 'selected' : ''}>Food</option>
        <option value="snack" ${kategori === 'snack' ? 'selected' : ''}>Snack</option>
        <option value="drink" ${kategori === 'drink' ? 'selected' : ''}>Drink</option>
      </select>
      <button class="btn-danger" onclick="this.parentElement.remove()">Hapus</button>
    `;
    container.appendChild(div);
  }

  function tambahNomorWa(value = '') {
    const container = document.getElementById('nomorWaContainer');
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'nomor-wa';
    input.placeholder = 'Contoh: 6281234567890';
    input.value = value;
    container.appendChild(input);
  }

  function ambilMenu(containerId) {
    const items = document.querySelectorAll(`#${containerId} .menu-item`);
    const list = [];
    items.forEach(item => {
      const nama = item.children[0]?.value.trim();
      const harga = parseFloat(item.children[1]?.value.trim());
      const kategori = item.children[2]?.value;
      if (nama && !isNaN(harga)) list.push({ nama, harga, kategori });
    });
    return list;
  }

  function simpanData() {
  try {
    const namaRestoran = document.getElementById("namaRestoran").value;
    const deskripsi = document.getElementById("deskripsi").value;
    const logo = document.getElementById("logoPreview").src;
    const flipbook = document.getElementById("flipbookPreview")?.src || "";
    const menuItems = [];

    document.querySelectorAll(".menu-item").forEach((item) => {
      const nama = item.querySelector(".nama-menu").value;
      const harga = item.querySelector(".harga-menu").value;
      const kategori = item.querySelector(".kategori-menu").value;
      const gambar = item.querySelector(".gambar-preview").src;

      if (nama && harga && kategori) {
        menuItems.push({ nama, harga, kategori, gambar });
      }
    });

    // Ambil galeri foto ruangan
    const fotoRuangan = [];
    document.querySelectorAll(".foto-ruangan-preview").forEach((img) => {
      if (img.src) {
        fotoRuangan.push(img.src);
      }
    });

    const data = {
      namaRestoran,
      deskripsi,
      logo,
      flipbook,
      galeriRuangan: fotoRuangan,
      menu: menuItems,
    };

    localStorage.setItem("menuvaData", JSON.stringify(data));
    alert("Data berhasil disimpan!");
  } catch (error) {
    console.error("Gagal menyimpan data:", error);
    alert("Terjadi kesalahan saat menyimpan data. Silakan cek kembali input dan koneksi Anda.");
  }
}


  function resetData() {
    if (confirm("Yakin ingin menghapus semua data?")) {
      localStorage.removeItem('menuvaData');
      location.reload();
    }
  }

  document.getElementById('logoInput')?.addEventListener('change', function(e) {
    const reader = new FileReader();
    reader.onload = function(event) {
      document.getElementById('previewLogo').src = event.target.result;
    };
    reader.readAsDataURL(e.target.files[0]);
  });

  document.getElementById('flipbookRuanganUpload')?.addEventListener('change', function(e) {
    const files = Array.from(e.target.files);
    const previewDiv = document.getElementById('flipbookRuanganPreview');
    previewDiv.innerHTML = '';
    flipbookRuanganImages = [];

    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = function(event) {
        flipbookRuanganImages.push(event.target.result);
        const img = document.createElement('img');
        img.src = event.target.result;
        previewDiv.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  document.getElementById('flipbookMenuUpload')?.addEventListener('change', function(e) {
    const files = Array.from(e.target.files);
    const previewDiv = document.getElementById('flipbookMenuPreview');
    previewDiv.innerHTML = '';
    flipbookMenuImages = [];

    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = function(event) {
        flipbookMenuImages.push(event.target.result);
        const img = document.createElement('img');
        img.src = event.target.result;
        previewDiv.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  function backupData() {
    const data = localStorage.getItem('menuvaData');
    if (!data) return alert('Tidak ada data untuk dibackup.');
    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "backup-menuva.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  document.getElementById('restoreInput')?.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
      try {
        const data = JSON.parse(event.target.result);
        localStorage.setItem('menuvaData', JSON.stringify(data));
        alert('✅ Data berhasil di-restore!');
        location.reload();
      } catch (err) {
        alert('❌ Format file tidak valid.');
      }
    };
    reader.readAsText(file);
  });

  function salinLinkMenu() {
    const linkMenu = `${window.location.origin}/menu.html`;
    navigator.clipboard.writeText(linkMenu)
      .then(() => {
        alert(`✅ Link menu berhasil disalin:\n${linkMenu}`);
        window.open(linkMenu, '_blank');
      })
      .catch(() => alert('❌ Gagal menyalin link'));
  }

  window.onload = function() {
    const saved = localStorage.getItem('menuvaData');
    if (saved) {
      const data = JSON.parse(saved);
      document.getElementById('namaRestoran').value = data.namaRestoran || '';
      if (data.logo) document.getElementById('previewLogo').src = data.logo;

      (data.menu || []).forEach(m => tambahMenu(m.kategori, m.nama, m.harga));
      (data.nomorWaAdmin || []).forEach(no => tambahNomorWa(no));

      if (data.flipbookRuanganImages) {
        flipbookRuanganImages = data.flipbookRuanganImages;
        const preview = document.getElementById('flipbookRuanganPreview');
        flipbookRuanganImages.forEach(src => {
          const img = document.createElement('img');
          img.src = src;
          preview.appendChild(img);
        });
      }

      if (data.flipbookMenuImages) {
        flipbookMenuImages = data.flipbookMenuImages;
        const preview = document.getElementById('flipbookMenuPreview');
        flipbookMenuImages.forEach(src => {
          const img = document.createElement('img');
          img.src = src;
          preview.appendChild(img);
        });
      }
    }
  };
</script>


</body>
</html>
