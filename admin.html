<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
   * { box-sizing: border-box; }
       body {
      font-family: Arial, sans-serif;
      padding: 20px;
      padding-bottom: 90px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2,h3 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
      background: linear-gradient(135deg, #7f5af0, #2cb5e8);
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
     .btn-plus {
      background-color: #87CEFA;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}
.room-section > div:nth-child(2) button {
  padding: 6px 14px;
  border-radius: 6px;
  background-color: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
.room-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.room-form {
  padding: 10px;
  border: 1px dashed #ccc;
  margin-bottom: 12px;
  border-radius: 6px;
  background-color: #fff;
}
.room-form input[type="text"],
.room-form input[type="number"],
.room-form input[type="file"] {
  display: block;
  margin-bottom: 8px;
  width: 100%;
  padding: 6px;
  font-size: 14px;
}
.room-form .room-preview img {
  max-height: 80px;
  margin-top: 4px;
}

.gambar-preview-wrapper {
  position: relative;
  display: inline-block;
  margin-top: 10px;
}

.gambar-preview {
  height: auto !important;
  width: auto !important;
  max-height: 200px !important; /* Ubah sesuai keinginan */
  max-width: 100% !important;
  display: block;
}
.hapus-gambar {
  position: absolute;
  top: -8px;
  right: -8px;
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 14px;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  transition: background 0.2s;
}

.hapus-gambar:hover {
  background: #cc0000;
}
  .btn-hapus-gambar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: none;
  background: red;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: background 0.2s, transform 0.1s ease;
}

.btn-hapus-gambar:hover {
  background: #cc0000;
  transform: scale(1.05);
}

.section-box {
  border: none;
  padding: 16px;
  margin-bottom: 24px;
  border-radius: 8px;
  background: #fff;
}

.section-box h2,
.section-box h3 {
  margin-top: 0;
}

.room-section {
  margin-bottom: 20px;
}

.room-section button {
  margin-bottom: 10px;
  background-color: #CAE1FF;
}
.btn-simpan {
    background-color: #17a2b8;
    color: white;
    font-weight: bold;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
  }
    /* ğŸ”® Tombol Tambah - Ungu/Biru Neon */
.btn-tambah-room {
  background: linear-gradient(135deg, #7f5af0, #2cb5e8);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(127, 90, 240, 0.3);
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-tambah-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(44, 181, 232, 0.5);
}
.btn-hapus-room {
  background: linear-gradient(135deg, #ff6b6b, #fbc687);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
  margin-top: 10px;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-hapus-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(251, 198, 135, 0.5);
}

/* ğŸ–¼ï¸ Upload Gambar - Sky Blue Gradient */
.btn-upload-gambar {
  background: linear-gradient(135deg, #00c6ff, #0072ff);
  color: white;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  margin-top: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.3s ease;
}
.btn-upload-gambar:hover {
  opacity: 0.85;
}

    /* Fixed button bar bawah layar */
    .fixed-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #ddd;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 10px 20px;
      z-index: 10000;
    }
    .fixed-bar button {
      flex: 1;
      padding: 10px 0;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: white;
    }
    .btn-order {
      background-color: #007bff;
    }
    .btn-order:hover {
      background-color: #0056b3;
    }
    .btn-room {
      background-color: #28a745;
    }
    .btn-room:hover {
      background-color: #1e7e34;
    }

    @media (max-width: 480px) {
      .fixed-bar {
        flex-direction: column;
        padding: 10px;
        gap: 8px;
      }
      .fixed-bar button {
        width: 100%;
        margin: 0;
      }
      .fixed-bar button:last-child {
        margin-bottom: 0;
      }
    }

    
  </style>
</head>
<body>

  <div class="menuva-logo">
    <img src="menuva-logo.png" alt="Logo Menuva">
  </div>
    
    <div class="section">
    <h2>ğŸ“‡ Identitas Restoran</h2>
    <input type="file" id="logoInput" accept="image/*" />
    <img id="previewLogo" src="" alt="Logo Restoran" style="max-height: 80px; margin-top: 10px;" />
    <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
    <label for="restoAddress">Alamat Restoran</label>
    <input id="restoAddress" type="text" placeholder="Jl. Sudirman No. 10, Jakarta" />
    <label for="restoPhone">No. Telepon</label>
    <input id="restoPhone" type="text" placeholder="08xx-xxxx-xxxx" />
  </div>

  <div class="section">
    <h2>ğŸ”¥ Menu Promo</h2>
    <div id="promoContainer"></div>
    <button class="btn-orange" onclick="tambahPromo()">+ Tambah Menu Promo</button>
  </div>

  <div class="section">
    <h2>ğŸ“‹ FOOD MENU</h2>
    <div id="menuFoodContainer"></div>
    <button class="btn-success" onclick="tambahMenu('food')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ SNACK & DESSERT</h2>
    <div id="menuSnackContainer"></div>
    <button class="btn-success" onclick="tambahMenu('snack')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ DRINK</h2>
    <div id="menuDrinkContainer"></div>
    <button class="btn-success" onclick="tambahMenu('drink')">+ Tambah Menu</button>
  </div>
  
  <!-- ğŸ“± Nomor WhatsApp Admin -->
<div class="section-box" id="waContainerBox">
  <h3>ğŸ“± Nomor WhatsApp Admin (Penerima Pesanan/Reservasi)</h3>
  <div id="nomorWaContainer">
    <input type="text" class="nomor-wa" placeholder="Contoh: 6281234567890">
  </div>
  <button class="btn-plus" onclick="tambahNomorWa()">+ Tambah Nomor WA</button>
</div>
  
 <div class="section">
  <h2>ğŸ“¸ Galeri Ruangan</h2>
  <button class="btn-plus" onclick="tambahGambar('ruangan')">+ Tambah Gambar Ruangan</button>
  <input type="file" id="flipbookRuanganUpload" accept="image/*" multiple style="display:none;" />
  <div id="flipbookRuanganPreview"></div>
</div>

<div class="section">
  <h2>ğŸ“– Menu Restoran</h2>
  <button class="btn-plus" onclick="tambahGambar('menu')">+ Tambah Gambar Menu</button>
  <input type="file" id="flipbookMenuUpload" accept="image/*" multiple style="display:none;" />
  <div id="flipbookMenuPreview"></div>
</div>

<!-- ğŸ¨ Room / Package -->
<div class="section-box" id="roomContainerBox">
  <h2>ğŸ¨ Room / Package</h2>

  <!-- Room Hotel -->
  <div class="room-section">
    <h3>ğŸ›ï¸ Room Hotel</h3>
    <button class="btn-plus" onclick="tambahRoom('hotel')">+ Tambah Room Hotel</button>
    <div id="roomHotelContainer"></div>
  </div>

  <!-- Meeting Room -->
  <div class="room-section">
    <h3>ğŸ’¼ Meeting Room</h3>
    <button class="btn-plus" onclick="tambahRoom('meeting')">+ Tambah Meeting Room</button>
    <div id="meetingRoomContainer"></div>
  </div>

  <!-- Package -->
  <div class="room-section">
    <h3>ğŸ Package</h3>
    <button class="btn-plus" onclick="tambahRoom('package')">+ Tambah Package</button>
    <div id="packageContainer"></div>
  </div>
</div>

<hr>
  <div class="section">
    <button class="btn-success" onclick="simpanData()">ğŸ’¾ Simpan Semua</button>
    <button onclick="window.open('menu.html')" style="margin-top: 10px;" class="btn-orange">ğŸ‘ï¸ Lihat Halaman Customer</button>
    <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: rgb(58, 82, 219); color: white; padding: 10px; border: none; border-radius: 8px; margin-top: 10px;">
      ğŸ“‹ Copy Link Untuk Dibagikan Ke Customers
    </button>
    
     <h2>ğŸ” Backup & Restore Data</h2>
  <button onclick="backupData()">ğŸ“¦ Backup Data</button>

  <!-- Tempat status -->
  <div id="backupDownloadLink" style="margin-top:10px;"></div>

  <!-- Input Restore -->
  <label for="restoreInput" style="margin-top: 20px; display: block;">
    ğŸ“‚ Pilih File JSON untuk Restore:
  </label>
  <input type="file" id="restoreInput" accept=".json" onchange="restoreDataFromFile(event)" />
</div>
  
  <div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
    <strong>Panduan Penggunaan:</strong><br>
    PENTING!!<br>
    ğŸ”¹ Klik <strong>â¬‡ï¸ Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
    ğŸ”¹ Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
    ğŸ”¹ Klik <strong>ğŸ“‚ Pilih File</strong untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
    âš ï¸ Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
    ğŸ’¡ Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
  </div>
  </div>

<!-- Firebase CDN (compat) -->
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

<script type="text/javascript">
/* =========================
   Firebase Init (Compat)
========================= */
const firebaseConfig = {
  apiKey: "AIzaSyBxKnIO_cIX8B94608zdx5uGs_o4M7ctEk",
  authDomain: "menuvaresto.firebaseapp.com",
  projectId: "menuvaresto",
  storageBucket: "menuvaresto.appspot.com",
  messagingSenderId: "576149783998",
  appId: "1:576149783998:web:7ace26d67b02d45226e5ef"
};
const app = firebase.initializeApp(firebaseConfig);
const firestore = firebase.firestore(app); // compat style

/* =========================
   IndexedDB Helpers
========================= */
const DB_NAME = "menuvaDB";
const STORE   = "menuvaData";
const FIX_ID  = "menuvaData";

function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, 1);
    req.onupgradeneeded = (e) => {
      const db = e.target.result;
      if (!db.objectStoreNames.contains(STORE)) {
        db.createObjectStore(STORE, { keyPath: "id" });
      }
    };
    req.onsuccess = (e) => resolve(e.target.result);
    req.onerror   = () => reject(req.error);
  });
}

function saveDataToDB(data) {
  return new Promise(async (resolve, reject) => {
    try {
      if (!data.id) data.id = FIX_ID;
      const db = await openDB();
      const tx = db.transaction(STORE, "readwrite");
      const store = tx.objectStore(STORE);

      const clearReq = store.clear();
      clearReq.onsuccess = () => {
        const putReq = store.put(data);
        putReq.onsuccess = () => { db.close(); resolve(true); };
        putReq.onerror   = () => { db.close(); reject(putReq.error); };
      };
      clearReq.onerror = () => { db.close(); reject(clearReq.error); };
    } catch (err) {
      reject(err);
    }
  });
}

function loadDataFromDB() {
  return new Promise(async (resolve, reject) => {
    try {
      const db = await openDB();
      const tx = db.transaction(STORE, "readonly");
      const store = tx.objectStore(STORE);
      const getReq = store.get(FIX_ID);
      getReq.onsuccess = () => { db.close(); resolve(getReq.result || null); };
      getReq.onerror   = () => { db.close(); reject(getReq.error); };
    } catch (err) {
      reject(err);
    }
  });
}

/* =========================
   Firestore Save (Compat)
========================= */
async function saveToFirestore(data) {
  try {
    await firestore.collection("menuva").doc("data").set(data);
    console.log("Data tersimpan di Firestore âœ…");
  } catch (err) {
    console.error("Gagal simpan Firestore", err);
  }
}

/* =========================
   Backup & Restore
========================= */
async function backupData() {
  try {
    const data = await loadDataFromDB();
    if (!data) { alert("Tidak ada data untuk di-backup!"); return; }
    const filename = `menuva-backup-${Date.now()}.json`;
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const url  = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
    const statusDiv = document.getElementById("backupDownloadLink");
    if (statusDiv) {
      statusDiv.innerHTML = `
        âœ… Backup berhasil! File <strong>${filename}</strong> siap di-download.<br>
        <a href="${url}" download="${filename}" style="margin-top:10px;display:inline-block;padding:10px 16px;background:#007bff;color:white;text-decoration:none;border-radius:6px;">
          ğŸ“¥ Klik di sini jika download tidak dimulai otomatis
        </a>
      `;
    }
  } catch (err) {
    alert("âŒ Gagal backup data: " + err.message);
  }
}

function restoreDataFromFile(event) {
  const file = event?.target?.files?.[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = async (e) => {
    try {
      const json = JSON.parse(e.target.result);
      if (!json.id) json.id = FIX_ID;
      await saveDataToDB(json);
      alert("âœ… Data berhasil direstore dari file!\nHalaman akan dimuat ulang...");
      location.reload();
    } catch (err) {
      console.error("Restore error:", err);
      alert("âŒ Gagal membaca file JSON. Pastikan file valid.");
    }
  };
  reader.readAsText(file);
}

/* =========================
   Upload â†’ Preview
========================= */
function handleImageUpload(e, previewId) {
  const file = e?.target?.files?.[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    const img = document.getElementById(previewId);
    if (img) img.src = reader.result;
  };
  reader.readAsDataURL(file);
}

/* =========================
   Fungsi Global (Stub)
========================= */
window.tambahPromo = function(nama, harga, deskripsi) { console.log("Tambah promo:", nama, harga, deskripsi); };
window.tambahMenu = function(kategori, nama, harga) { console.log("Tambah menu:", kategori, nama, harga); };
window.tambahGambar = function(url, type) { console.log("Tambah gambar:", type, url); };
window.renderPromoUI = function() { console.log("Render promo UI"); };
window.renderImagePreview = function(type, url) { console.log("Render image preview:", type, url); };
window.ambilMenu = function(containerId) { console.log("Ambil menu dari:", containerId); return []; };
window.ambilSemuaRoom = function() { console.log("Ambil semua room"); return []; };
window.restoreRoomFromData = function(rooms) { console.log("Restore rooms:", rooms); };

/* =========================
   Simpan & Load Semua
========================= */
async function simpanSemua() {
  const identitas = {
    namaRestoran: document.getElementById("restoName")?.value || "",
    nomorWA:     document.getElementById("restoWA")?.value   || "",
    logo:        document.getElementById("logoPreview")?.src || "",
  };
  const menus = [
    ...(window.ambilMenu ? window.ambilMenu("menuFoodContainer")  : []),
    ...(window.ambilMenu ? window.ambilMenu("menuSnackContainer") : []),
    ...(window.ambilMenu ? window.ambilMenu("menuDrinkContainer") : []),
  ];
  const rooms = window.ambilSemuaRoom ? window.ambilSemuaRoom() : [];
  const data = {
    id: FIX_ID,
    identitas,
    menu: menus,
    promo: window.menuPromo || [],
    rooms,
    flipbookRuangan: window.flipbookRuanganImages || [],
    flipbookMenu:    window.flipbookMenuImages    || []
  };
  try {
    await saveDataToDB(data);
    await saveToFirestore(data);
    alert("âœ… Data tersimpan di IndexedDB + Firestore");
  } catch (err) {
    console.error(err);
    alert("âŒ Gagal simpan data");
  }
}

async function loadSemuaData() {
  try {
    const data = await loadDataFromDB();
    if (!data || Object.keys(data).length === 0) return;

    const restoName = document.getElementById("restoName");
    const restoWA   = document.getElementById("restoWA");
    const logoPrev  = document.getElementById("logoPreview");
    if (restoName) restoName.value = data.identitas?.namaRestoran || "";
    if (restoWA)   restoWA.value   = data.identitas?.nomorWA      || "";
    if (logoPrev && data.identitas?.logo) logoPrev.src = data.identitas.logo;

    window.menuPromo = data.promo || [];
    if (typeof window.renderPromoUI === "function") window.renderPromoUI();

    ["menuFoodContainer","menuSnackContainer","menuDrinkContainer"].forEach(id=>{
      const el = document.getElementById(id);
      if (el) el.innerHTML = "";
    });
    (data.menu || []).forEach(m => { if (window.tambahMenu) window.tambahMenu(m.kategori, m.nama, m.harga); });
    if (window.restoreRoomFromData) window.restoreRoomFromData(data.rooms || []);
    window.flipbookRuanganImages = data.flipbookRuangan || [];
    window.flipbookMenuImages    = data.flipbookMenu    || [];
    if (window.renderImagePreview) {
      window.flipbookRuanganImages.forEach(url => window.renderImagePreview("ruangan", url));
      window.flipbookMenuImages.forEach(url    => window.renderImagePreview("menu",    url));
    }

    console.log("Data berhasil dimuat âœ…");
  } catch (err) {
    console.error("Gagal load data", err);
  }
}

/* =========================
   Auto Init
========================= */
document.addEventListener("DOMContentLoaded", () => { loadSemuaData(); });
window.addEventListener("error", (e) => { console.error("Global error:", e?.error || e?.message); });

/* =========================
   Expose fungsi penting ke HTML
========================= */
window.backupData = backupData;
window.restoreDataFromFile = restoreDataFromFile;
window.simpanSemua = simpanSemua;
window.handleImageUpload = handleImageUpload;

</script>

  <div class="fixed-bar">
  <button onclick="window.location.href='index.html'" class="btn-success">ğŸ”’ Logout</button>
  <button onclick="resetData()" class="btn-danger">ğŸ—‘ï¸ Reset Semua Data</button>
  </div>
  
</body>
</html>























































































