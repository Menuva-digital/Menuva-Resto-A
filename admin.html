<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}

  </style>
</head>
<body>

  <div class="menuva-logo">
    <img src="menuva-logo.png" alt="Logo Menuva">
  </div>

  <div class="section">
    <h2>📇 Identitas Restoran</h2>
    <input type="file" id="logoInput" accept="image/*" />
    <img id="previewLogo" src="" alt="Logo Restoran" style="max-height: 80px; margin-top: 10px;" />
    <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
  </div>

  <div class="section">
    <h2>📋 FOOD MENU</h2>
    <div id="menuFoodContainer"></div>
    <button class="btn-success" onclick="tambahMenu('food')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>📋 SNACK & DESSERT</h2>
    <div id="menuSnackContainer"></div>
    <button class="btn-success" onclick="tambahMenu('snack')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>📋 DRINK</h2>
    <div id="menuDrinkContainer"></div>
    <button class="btn-success" onclick="tambahMenu('drink')">+ Tambah Menu</button>
  </div>
  
  <h3>📱 Nomor WhatsApp Admin (Penerima Pesanan/Reservasi)</h3>
  <div id="nomorWaContainer">
  <input type="text" class="nomor-wa" placeholder="Contoh: 6281234567890">
  </div>
  <button onclick="tambahNomorWa()">Tambah Nomor WA</button>

 <div class="section">
  <h2>📸 Galeri Ruangan</h2>
  <button onclick="tambahGambar('ruangan')">+ Tambah Gambar Ruangan</button>
  <div id="flipbookRuanganPreview"></div>
</div>

<div class="section">
  <h2>📖 Menu Restoran</h2>
  <button onclick="tambahGambar('menu')">+ Tambah Gambar Menu</button>
  <div id="flipbookMenuPreview"></div>
</div>

  <div class="section">
    <button onclick="simpanData()">💾 Simpan Semua</button>
    <button onclick="window.open('menu.html')" style="margin-top: 10px;">👁️ Lihat Halaman Customer</button>
    <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: orange; color: white; padding: 10px; border: none; border-radius: 8px; margin-top: 10px;">
      📋 Salin Link menu.html
    </button>
    
    <!-- Backup dan Restore -->
<div class="section">
  <h2>🔁 Backup & Restore Data</h2>
  <button onclick="backupData()" class="btn-orange">⬇️ Backup Data</button>
  <input type="file" id="restoreInput" accept=".json" />
  
  <div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
    <strong>Panduan Penggunaan:</strong><br>
    PENTING!!<br>
    🔹 Klik <strong>⬇️ Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
    🔹 Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
    🔹 Klik <strong>📂 Pilih File</strong untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
    ⚠️ Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
    💡 Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
  </div>
</div>

    <button onclick="window.location.href='index.html'" class="btn-secondary" style="margin-top: 10px;">🔒 Logout</button>
    <button onclick="resetData()" class="btn-danger" style="margin-top: 10px;">🗑️ Reset Semua Data</button>
  </div>
<script>
  // Variabel global untuk menyimpan gambar flipbook yang sedang aktif
  let flipbookRuanganImages = JSON.parse(localStorage.getItem('menuvaData'))?.flipbookRuanganImages || [];
  let flipbookMenuImages = JSON.parse(localStorage.getItem('menuvaData'))?.flipbookMenuImages || [];

  // Fungsi tambah item menu (food, snack, drink)
  function tambahMenu(kategori = 'food', nama = '', harga = '') {
    const containerId = {
      food: 'menuFoodContainer',
      snack: 'menuSnackContainer',
      drink: 'menuDrinkContainer'
    }[kategori];

    const container = document.getElementById(containerId);
    const div = document.createElement('div');
    div.className = 'menu-item';
    div.innerHTML = `
      <input type="text" placeholder="Nama Menu" value="${nama}" />
      <input type="number" placeholder="Harga" value="${harga}" />
      <select>
        <option value="food" ${kategori === 'food' ? 'selected' : ''}>Food</option>
        <option value="snack" ${kategori === 'snack' ? 'selected' : ''}>Snack</option>
        <option value="drink" ${kategori === 'drink' ? 'selected' : ''}>Drink</option>
      </select>
      <button class="btn-danger" onclick="this.parentElement.remove()">Hapus</button>
    `;
    container.appendChild(div);
  }

  // Fungsi tambah input nomor WA admin
  function tambahNomorWa() {
    const container = document.getElementById('nomorWaContainer');
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'nomor-wa';
    input.placeholder = 'Contoh: 6281234567890';
    container.appendChild(input);
  }

  // Fungsi untuk simpan semua data ke localStorage
  function simpanData() {
    const namaRestoran = document.getElementById('namaRestoran').value;
    const logo = document.getElementById('previewLogo').src;

    function ambilMenu(containerId) {
      const items = document.querySelectorAll(`#${containerId} .menu-item`);
      const list = [];
      items.forEach(item => {
        const nama = item.children[0].value;
        const harga = item.children[1].value;
        const kategori = item.children[2].value;
        if (nama && harga) list.push({ nama, harga, kategori });
      });
      return list;
    }

    const nomorWaInputs = document.querySelectorAll('.nomor-wa');
    const nomorWaAdmin = [];
    nomorWaInputs.forEach(input => {
      const value = input.value.trim();
      if (value !== '') nomorWaAdmin.push(value);
    });

    const data = {
      namaRestoran,
      logo,
      nomorWaAdmin,
      flipbookRuanganImages,
      flipbookMenuImages,
      menu: [
        ...ambilMenu('menuFoodContainer'),
        ...ambilMenu('menuSnackContainer'),
        ...ambilMenu('menuDrinkContainer')
      ]
    };

    localStorage.setItem('menuvaData', JSON.stringify(data));
    alert('✅ Data berhasil disimpan!');
    document.getElementById('btnSalinLink').style.display = 'inline-block';
  }

  // Fungsi reset data localStorage dan reload halaman
  function resetData() {
    if (confirm("Yakin ingin menghapus semua data?")) {
      localStorage.removeItem('menuvaData');
      location.reload();
    }
  }

  // Event listener untuk upload logo, simpan langsung ke localStorage
  document.getElementById('logoInput').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function (event) {
      const logoUrl = event.target.result;
      document.getElementById('previewLogo').src = logoUrl;

      // Update localStorage dengan logo baru
      const saved = JSON.parse(localStorage.getItem('menuvaData')) || {};
      saved.logo = logoUrl;
      updateLocalStorage({ flipbookRuanganImages });
    };
    reader.readAsDataURL(e.target.files[0]);
  });

  // Event listener untuk upload gambar ruangan (multiple)
  document.getElementById('flipbookRuanganUpload').addEventListener('change', function (e) {
    const files = Array.from(e.target.files);
    const previewDiv = document.getElementById('flipbookRuanganPreview');
    previewDiv.innerHTML = '';
    flipbookRuanganImages = [];

    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = function (event) {
        const imageUrl = event.target.result;
        flipbookRuanganImages.push(imageUrl);
        renderImagePreview('ruangan', imageUrl);

        // Update localStorage
        const saved = JSON.parse(localStorage.getItem('menuvaData')) || {};
        saved.flipbookRuanganImages = flipbookRuanganImages;
        updateLocalStorage({ flipbookRuanganImages });
      };
      reader.readAsDataURL(file);
    });
  });

  // Event listener untuk upload gambar menu (multiple)
  document.getElementById('flipbookMenuUpload').addEventListener('change', function (e) {
    const files = Array.from(e.target.files);
    const previewDiv = document.getElementById('flipbookMenuPreview');
    previewDiv.innerHTML = '';
    flipbookMenuImages = [];

    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = function (event) {
        const imageUrl = event.target.result;
        flipbookMenuImages.push(imageUrl);
        renderImagePreview('menu', imageUrl);

        // Update localStorage
        const saved = JSON.parse(localStorage.getItem('menuvaData')) || {};
        saved.flipbookMenuImages = flipbookMenuImages;
        updateLocalStorage({ flipbookRuanganImages });

      };
      reader.readAsDataURL(file);
    });
  });

  function updateLocalStorage(updates) {
  const saved = JSON.parse(localStorage.getItem('menuvaData')) || {};
  const merged = { ...saved, ...updates };
  updateLocalStorage({ flipbookRuanganImages });
}


  // Fungsi backup data ke file JSON
  function backupData() {
    const data = localStorage.getItem('menuvaData');
    if (!data) return alert('Tidak ada data untuk dibackup.');
    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "backup-menuva.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  // Restore data dari file JSON dan reload halaman
  document.getElementById('restoreInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (event) {
      try {
        const data = JSON.parse(event.target.result);
        localStorage.setItem('menuvaData', JSON.stringify(data));
        alert('✅ Data berhasil di-restore!');
        location.reload();
      } catch (err) {
        alert('❌ Format file tidak valid.');
      }
    };
    reader.readAsText(file);
  });

  // Fungsi salin link menu ke clipboard dan buka di tab baru
  function salinLinkMenu() {
    const origin = window.location.origin;
    const linkMenu = `${origin}/menu.html`;

    navigator.clipboard.writeText(linkMenu)
      .then(() => {
        alert(`✅ Link menu berhasil disalin:\n${linkMenu}`);
        window.open(linkMenu, '_blank');
      })
      .catch(() => alert('❌ Gagal menyalin link'));
  }

  // Fungsi render preview gambar dengan tombol hapus
  function renderImagePreview(tipe, url) {
    const img = document.createElement('img');
    img.src = url;
    img.style.maxWidth = '100px';
    img.style.margin = '5px';
    img.style.border = '1px solid #ccc';

    const wrapper = document.createElement('div');
    wrapper.style.display = 'inline-block';
    wrapper.style.position = 'relative';
    wrapper.style.margin = '5px';

    const btnHapus = document.createElement('button');
    btnHapus.innerText = '❌';
    btnHapus.style.position = 'absolute';
    btnHapus.style.top = '0';
    btnHapus.style.right = '0';
    btnHapus.style.background = 'red';
    btnHapus.style.color = 'white';
    btnHapus.style.border = 'none';
    btnHapus.style.cursor = 'pointer';

    btnHapus.onclick = function () {
      wrapper.remove();
      if (tipe === 'ruangan') {
        flipbookRuanganImages = flipbookRuanganImages.filter(src => src !== url);
      } else {
        flipbookMenuImages = flipbookMenuImages.filter(src => src !== url);
      }
      // Update localStorage setelah hapus gambar
      localStorage.setItem('menuvaData', JSON.stringify({
        ...JSON.parse(localStorage.getItem('menuvaData') || '{}'),
        flipbookRuanganImages,
        flipbookMenuImages
      }));
    };

    wrapper.appendChild(img);
    wrapper.appendChild(btnHapus);

    if (tipe === 'ruangan') {
      document.getElementById('flipbookRuanganPreview').appendChild(wrapper);
    } else {
      document.getElementById('flipbookMenuPreview').appendChild(wrapper);
    }
  }

  // Load data dari localStorage saat halaman siap
  window.onload = function () {
    const saved = localStorage.getItem('menuvaData');
    if (saved) {
      const data = JSON.parse(saved);
      document.getElementById('namaRestoran').value = data.namaRestoran || '';
      if (data.logo) document.getElementById('previewLogo').src = data.logo;

      if (data.menu) {
        data.menu.forEach(m => tambahMenu(m.kategori || 'food', m.nama, m.harga));
      }

      if (data.nomorWaAdmin) {
        data.nomorWaAdmin.forEach(no => {
          tambahNomorWa();
          const nomorInputs = document.querySelectorAll('.nomor-wa');
          nomorInputs[nomorInputs.length - 1].value = no;
        });
      }

      if (data.flipbookRuanganImages) {
        flipbookRuanganImages = data.flipbookRuanganImages;
        flipbookRuanganImages.forEach(src => renderImagePreview('ruangan', src));
      }

      if (data.flipbookMenuImages) {
        flipbookMenuImages = data.flipbookMenuImages;
        flipbookMenuImages.forEach(src => renderImagePreview('menu', src));
      }
    }
  };

  // Fungsi tambah gambar via file input dan langsung preview + simpan localStorage
  function tambahGambar(tipe) {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.style.display = 'none';

    input.onchange = function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const url = event.target.result;

        // Render preview dan simpan ke array + localStorage
        renderImagePreview(tipe, url);

        if (tipe === 'ruangan') {
          flipbookRuanganImages.push(url);
        } else {
          flipbookMenuImages.push(url);
        }

        localStorage.setItem('menuvaData', JSON.stringify({
          ...JSON.parse(localStorage.getItem('menuvaData') || '{}'),
          flipbookRuanganImages,
          flipbookMenuImages
        }));
      };

      reader.readAsDataURL(file);
    };

    document.body.appendChild(input);
    input.click();
    document.body.removeChild(input);
  }
</script>

</body>
</html>
