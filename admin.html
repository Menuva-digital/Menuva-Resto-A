<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}

  </style>
</head>
<body>

  <div class="menuva-logo">
    <img src="menuva-logo.png" alt="Logo Menuva">
  </div>

  <div class="section">
    <h2>ğŸ“‡ Identitas Restoran</h2>
    <input type="file" id="logoInput" accept="image/*" />
    <img id="previewLogo" src="" alt="Logo Restoran" style="max-height: 80px; margin-top: 10px;" />
    <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
  </div>

  <div class="section">
    <h2>ğŸ“‹ FOOD MENU</h2>
    <div id="menuFoodContainer"></div>
    <button class="btn-success" onclick="tambahMenu('food')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ SNACK & DESSERT</h2>
    <div id="menuSnackContainer"></div>
    <button class="btn-success" onclick="tambahMenu('snack')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ DRINK</h2>
    <div id="menuDrinkContainer"></div>
    <button class="btn-success" onclick="tambahMenu('drink')">+ Tambah Menu</button>
  </div>
  
  <h3>ğŸ“± Nomor WhatsApp Admin (Penerima Pesanan/Reservasi)</h3>
  <input type="text" id="waAdmin"><br>


  <div class="section">
    <h2>ğŸ“¸ Galeri Ruangan</h2>
    <input type="file" id="flipbookRuanganUpload" accept="image/*" multiple />
    <div id="flipbookRuanganPreview" class="preview"></div>
  </div>

  <div class="section">
    <h2>ğŸ“– Menu Restoran</h2>
    <input type="file" id="flipbookMenuUpload" accept="image/*" multiple />
    <div id="flipbookMenuPreview" class="preview"></div>
  </div>

  <div class="section">
    <button onclick="simpanData()">ğŸ’¾ Simpan Semua</button>
    <button onclick="window.open('menu.html')" style="margin-top: 10px;">ğŸ‘ï¸ Lihat Halaman Customer</button>
    <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: orange; color: white; padding: 10px; border: none; border-radius: 8px; margin-top: 10px;">
      ğŸ“‹ Salin Link menu.html
    </button>
    
    <!-- Backup dan Restore -->
<div class="section">
  <h2>ğŸ” Backup & Restore Data</h2>
  <button onclick="backupData()" class="btn-orange">â¬‡ï¸ Backup Data</button>
  <input type="file" id="restoreInput" accept=".json" />
  
  <div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
    <strong>Panduan Penggunaan:</strong><br>
    PENTING!!<br>
    ğŸ”¹ Klik <strong>â¬‡ï¸ Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
    ğŸ”¹ Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
    ğŸ”¹ Klik <strong>ğŸ“‚ Pilih File</strong untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
    âš ï¸ Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
    ğŸ’¡ Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
  </div>
</div>

    <button onclick="window.location.href='index.html'" class="btn-secondary" style="margin-top: 10px;">ğŸ”’ Logout</button>
    <button onclick="resetData()" class="btn-danger" style="margin-top: 10px;">ğŸ—‘ï¸ Reset Semua Data</button>
  </div>
   <script>
    const imgbbAPIKey = "1f46c24e61ffbffb9c1d62102899e11c";

    let flipbookMenuImages = [];
    let flipbookRuanganImages = [];

    async function uploadToImgBB(file) {
      const form = new FormData();
      form.append("image", file);
      const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbAPIKey}`, {
        method: "POST",
        body: form
      });
      const result = await response.json();
      if (result.success) return result.data.url;
      else throw new Error("Gagal upload ke imgBB");
    }

    document.getElementById("logo").addEventListener("change", async function () {
      const file = this.files[0];
      if (!file) return;
      try {
        const url = await uploadToImgBB(file);
        document.getElementById("previewLogo").src = url;
        document.getElementById("previewLogo").style.display = 'block';
      } catch (err) {
        alert("Gagal upload logo");
      }
    });

    document.getElementById("fotoRuangan").addEventListener("change", async function () {
      const files = Array.from(this.files);
      const preview = document.getElementById("previewRuangan");
      preview.innerHTML = "";
      flipbookRuanganImages = [];

      for (const file of files) {
        try {
          const url = await uploadToImgBB(file);
          flipbookRuanganImages.push(url);
          const img = document.createElement("img");
          img.src = url;
          img.className = "preview-img";
          preview.appendChild(img);
        } catch (err) {
          alert("Gagal upload salah satu foto ruangan");
        }
      }
    });

    document.getElementById("flipbookMenu").addEventListener("change", async function () {
      const files = Array.from(this.files);
      const preview = document.getElementById("previewMenu");
      preview.innerHTML = "";
      flipbookMenuImages = [];

      for (const file of files) {
        try {
          const url = await uploadToImgBB(file);
          flipbookMenuImages.push(url);
          const img = document.createElement("img");
          img.src = url;
          img.className = "preview-img";
          preview.appendChild(img);
        } catch (err) {
          alert("Gagal upload salah satu gambar menu");
        }
      }
    });

    function simpanData() {
      try {
        const namaRestoran = document.getElementById("namaRestoran").value.trim();
        const waAdmin = document.getElementById("waAdmin").value.trim();
        const logo = document.getElementById("previewLogo")?.src || "";

        if (!namaRestoran || !waAdmin) {
          alert("Isi nama restoran dan WA admin dulu!");
          return;
        }

        const data = {
          namaRestoran,
          waAdmin,
          logo,
          galeriRuangan: flipbookRuanganImages,
          flipbookMenu: flipbookMenuImages
        };

        localStorage.setItem("menuvaData", JSON.stringify(data));
        alert("âœ… Data berhasil disimpan!");
      } catch (err) {
        alert("âŒ Terjadi kesalahan saat menyimpan data.");
        console.error("Gagal menyimpan data:", err);
      }
    }

    // Restore jika sudah ada
    window.onload = function () {
      const data = localStorage.getItem("menuvaData");
      if (data) {
        const parsed = JSON.parse(data);
        document.getElementById("namaRestoran").value = parsed.namaRestoran || "";
        document.getElementById("waAdmin").value = parsed.waAdmin || "";

        if (parsed.logo) {
          document.getElementById("previewLogo").src = parsed.logo;
          document.getElementById("previewLogo").style.display = 'block';
        }

        if (parsed.galeriRuangan && Array.isArray(parsed.galeriRuangan)) {
          const preview = document.getElementById("previewRuangan");
          parsed.galeriRuangan.forEach(url => {
            const img = document.createElement("img");
            img.src = url;
            img.className = "preview-img";
            preview.appendChild(img);
          });
          flipbookRuanganImages = parsed.galeriRuangan;
        }

        if (parsed.flipbookMenu && Array.isArray(parsed.flipbookMenu)) {
          const preview = document.getElementById("previewMenu");
          parsed.flipbookMenu.forEach(url => {
            const img = document.createElement("img");
            img.src = url;
            img.className = "preview-img";
            preview.appendChild(img);
          });
          flipbookMenuImages = parsed.flipbookMenu;
        }
      }
    };
  </script>
</body>
</html>
