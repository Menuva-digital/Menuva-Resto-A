<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
   * { box-sizing: border-box; }
       body {
      font-family: Arial, sans-serif;
      padding: 20px;
      padding-bottom: 90px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2,h3 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
      background: linear-gradient(135deg, #7f5af0, #2cb5e8);
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
     .btn-plus {
      background-color: #87CEFA;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}
.room-section > div:nth-child(2) button {
  padding: 6px 14px;
  border-radius: 6px;
  background-color: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
.room-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.room-form {
  padding: 10px;
  border: 1px dashed #ccc;
  margin-bottom: 12px;
  border-radius: 6px;
  background-color: #fff;
}
.room-form input[type="text"],
.room-form input[type="number"],
.room-form input[type="file"] {
  display: block;
  margin-bottom: 8px;
  width: 100%;
  padding: 6px;
  font-size: 14px;
}
.room-form .room-preview img {
  max-height: 80px;
  margin-top: 4px;
}

.gambar-preview-wrapper {
  position: relative;
  display: inline-block;
  margin-top: 10px;
}

.gambar-preview {
  height: auto !important;
  width: auto !important;
  max-height: 200px !important; /* Ubah sesuai keinginan */
  max-width: 100% !important;
  display: block;
}
.hapus-gambar {
  position: absolute;
  top: -8px;
  right: -8px;
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 14px;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  transition: background 0.2s;
}

.hapus-gambar:hover {
  background: #cc0000;
}
  .btn-hapus-gambar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: none;
  background: red;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: background 0.2s, transform 0.1s ease;
}

.btn-hapus-gambar:hover {
  background: #cc0000;
  transform: scale(1.05);
}

.section-box {
  border: none;
  padding: 16px;
  margin-bottom: 24px;
  border-radius: 8px;
  background: #fff;
}

.section-box h2,
.section-box h3 {
  margin-top: 0;
}

.room-section {
  margin-bottom: 20px;
}

.room-section button {
  margin-bottom: 10px;
  background-color: #CAE1FF;
}
.btn-simpan {
    background-color: #17a2b8;
    color: white;
    font-weight: bold;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
  }
    /* ğŸ”® Tombol Tambah - Ungu/Biru Neon */
.btn-tambah-room {
  background: linear-gradient(135deg, #7f5af0, #2cb5e8);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(127, 90, 240, 0.3);
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-tambah-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(44, 181, 232, 0.5);
}
.btn-hapus-room {
  background: linear-gradient(135deg, #ff6b6b, #fbc687);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
  margin-top: 10px;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-hapus-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(251, 198, 135, 0.5);
}

/* ğŸ–¼ï¸ Upload Gambar - Sky Blue Gradient */
.btn-upload-gambar {
  background: linear-gradient(135deg, #00c6ff, #0072ff);
  color: white;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  margin-top: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.3s ease;
}
.btn-upload-gambar:hover {
  opacity: 0.85;
}

    /* Fixed button bar bawah layar */
    .fixed-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #ddd;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 10px 20px;
      z-index: 10000;
    }
    .fixed-bar button {
      flex: 1;
      padding: 10px 0;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: white;
    }
    .btn-order {
      background-color: #007bff;
    }
    .btn-order:hover {
      background-color: #0056b3;
    }
    .btn-room {
      background-color: #28a745;
    }
    .btn-room:hover {
      background-color: #1e7e34;
    }

    @media (max-width: 480px) {
      .fixed-bar {
        flex-direction: column;
        padding: 10px;
        gap: 8px;
      }
      .fixed-bar button {
        width: 100%;
        margin: 0;
      }
      .fixed-bar button:last-child {
        margin-bottom: 0;
      }
    }

    
  </style>
</head>
<body>

  <div class="menuva-logo">
    <img src="menuva-logo.png" alt="Logo Menuva">
  </div>
    
    <div class="section">
    <h2>ğŸ“‡ Identitas Restoran</h2>
    <input type="file" id="logoInput" accept="image/*" />
    <img id="previewLogo" src="" alt="Logo Restoran" style="max-height: 80px; margin-top: 10px;" />
    <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
    <label for="restoAddress">Alamat Restoran</label>
    <input id="restoAddress" type="text" placeholder="Jl. Sudirman No. 10, Jakarta" />
    <label for="restoPhone">No. Telepon</label>
    <input id="restoPhone" type="text" placeholder="08xx-xxxx-xxxx" />
  </div>

  <div class="section">
    <h2>ğŸ”¥ Menu Promo</h2>
    <div id="promoContainer"></div>
    <button class="btn-orange" onclick="tambahPromo()">+ Tambah Menu Promo</button>
  </div>

  <div class="section">
    <h2>ğŸ“‹ FOOD MENU</h2>
    <div id="menuFoodContainer"></div>
    <button class="btn-success" onclick="tambahMenu('food')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ SNACK & DESSERT</h2>
    <div id="menuSnackContainer"></div>
    <button class="btn-success" onclick="tambahMenu('snack')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ DRINK</h2>
    <div id="menuDrinkContainer"></div>
    <button class="btn-success" onclick="tambahMenu('drink')">+ Tambah Menu</button>
  </div>
  
  <!-- ğŸ“± Nomor WhatsApp Admin -->
<div class="section-box" id="waContainerBox">
  <h3>ğŸ“± Nomor WhatsApp Admin (Penerima Pesanan/Reservasi)</h3>
  <div id="nomorWaContainer">
    <input type="text" class="nomor-wa" placeholder="Contoh: 6281234567890">
  </div>
  <button class="btn-plus" onclick="tambahNomorWa()">+ Tambah Nomor WA</button>
</div>
  
 <div class="section">
  <h2>ğŸ“¸ Galeri Ruangan</h2>
  <button class="btn-plus" onclick="tambahGambar('ruangan')">+ Tambah Gambar Ruangan</button>
  <input type="file" id="flipbookRuanganUpload" accept="image/*" multiple style="display:none;" />
  <div id="flipbookRuanganPreview"></div>
</div>

<div class="section">
  <h2>ğŸ“– Menu Restoran</h2>
  <button class="btn-plus" onclick="tambahGambar('menu')">+ Tambah Gambar Menu</button>
  <input type="file" id="flipbookMenuUpload" accept="image/*" multiple style="display:none;" />
  <div id="flipbookMenuPreview"></div>
</div>

<!-- ğŸ¨ Room / Package -->
<div class="section-box" id="roomContainerBox">
  <h2>ğŸ¨ Room / Package</h2>

  <!-- Room Hotel -->
  <div class="room-section">
    <h3>ğŸ›ï¸ Room Hotel</h3>
    <button class="btn-plus" onclick="tambahRoom('hotel')">+ Tambah Room Hotel</button>
    <div id="roomHotelContainer"></div>
  </div>

  <!-- Meeting Room -->
  <div class="room-section">
    <h3>ğŸ’¼ Meeting Room</h3>
    <button class="btn-plus" onclick="tambahRoom('meeting')">+ Tambah Meeting Room</button>
    <div id="meetingRoomContainer"></div>
  </div>

  <!-- Package -->
  <div class="room-section">
    <h3>ğŸ Package</h3>
    <button class="btn-plus" onclick="tambahRoom('package')">+ Tambah Package</button>
    <div id="packageContainer"></div>
  </div>
</div>

<hr>
  <div class="section">
    <button class="btn-success" onclick="simpanData()">ğŸ’¾ Simpan Semua</button>
    <button onclick="window.open('menu.html')" style="margin-top: 10px;" class="btn-orange">ğŸ‘ï¸ Lihat Halaman Customer</button>
    <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: rgb(58, 82, 219); color: white; padding: 10px; border: none; border-radius: 8px; margin-top: 10px;">
      ğŸ“‹ Copy Link Untuk Dibagikan Ke Customers
    </button>
    
    <!-- Backup dan Restore -->

    <div class="section">
      <h2>ğŸ” Backup & Restore Data</h2>
     <button class="btn-secondary" onclick="backupData()">ğŸ“¦ Backup Data</button>

     <!-- Tempat status -->
     <div id="backupDownloadLink" style="margin-top:10px;"></div>

      
      <!-- Input Restore -->
      <label for="restoreInput" style="margin-top: 20px; display: block;">
        ğŸ“‚ Pilih File JSON untuk Restore:
      </label>
      <input type="file" id="restoreInput" accept=".json" onchange="restoreDataFromFile(event)" />
    </div>
  
  <div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
    <strong>Panduan Penggunaan:</strong><br>
    PENTING!!<br>
    ğŸ”¹ Klik <strong>â¬‡ï¸ Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
    ğŸ”¹ Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
    ğŸ”¹ Klik <strong>ğŸ“‚ Pilih File</strong untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
    âš ï¸ Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
    ğŸ’¡ Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
  </div>
  </div>

<script type="module">
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IMPORT & INIT FIREBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import { initializeApp } from "firebase/app";
import { getFirestore, doc, setDoc } from "firebase/firestore";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBxKnIO_cIX8B94608zdx5uGs_o4M7ctEk",
  authDomain: "menuvaresto.firebaseapp.com",
  projectId: "menuvaresto",
  storageBucket: "menuvaresto.appspot.com",
  messagingSenderId: "576149783998",
  appId: "1:576149783998:web:7ace26d67b02d45226e5ef"
};

const firebaseApp = initializeApp(firebaseConfig);
const firestore = getFirestore(firebaseApp);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ INDEXEDDB SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let idb;
const DB_NAME = "MenuvaDB";
const STORE_NAME = "menuvaData";
const DB_VERSION = 1;

function initDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);
    request.onerror = () => reject(request.error);
    request.onupgradeneeded = (event) => {
      idb = event.target.result;
      if (!idb.objectStoreNames.contains(STORE_NAME)) {
        idb.createObjectStore(STORE_NAME, { keyPath: "id" });
      }
    };
    request.onsuccess = (event) => {
      idb = event.target.result;
      resolve();
    };
  });
}

function saveDataToDB(data) {
  return new Promise((resolve, reject) => {
    if (!idb) return reject("DB belum diinisialisasi");
    const tx = idb.transaction(STORE_NAME, "readwrite");
    const store = tx.objectStore(STORE_NAME);
    const req = store.put({ id: 1, ...data });
    req.onsuccess = () => resolve();
    req.onerror = () => reject(req.error);
    tx.onerror = () => reject(tx.error);
  });
}

function loadDataFromDB() {
  return new Promise((resolve, reject) => {
    if (!idb) return reject("DB belum diinisialisasi");
    const tx = idb.transaction(STORE_NAME, "readonly");
    const store = tx.objectStore(STORE_NAME);
    const req = store.get(1);
    req.onsuccess = () => resolve(req.result || {});
    req.onerror = () => reject(req.error);
    tx.onerror = () => reject(tx.error);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GLOBAL VARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let menuPromo = [];
let flipbookRuanganImages = [];
let flipbookMenuImages = [];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PROMO FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPromoUI() {
  const container = document.getElementById("promoContainer");
  container.innerHTML = "";
  menuPromo.forEach((promo, index) => {
    const div = document.createElement("div");
    div.className = "menu-item";
    div.innerHTML = `
      <input type="text" placeholder="Nama Promo" value="${promo.namaPromo||''}" onchange="updatePromo(${index},'namaPromo',this.value)">
      <input type="file" accept="image/*" onchange="uploadPromoImage(event,${index})">
      <img id="promoImgPreview${index}" src="${promo.image||''}" style="max-height:80px;margin:5px 0">
      <input type="text" placeholder="Nama Menu Promo" value="${promo.namaMenu||''}" onchange="updatePromo(${index},'namaMenu',this.value)">
      <input type="text" placeholder="Deskripsi Promo" value="${promo.deskripsi||''}" onchange="updatePromo(${index},'deskripsi',this.value)">
      <input type="number" placeholder="Harga Promo" value="${promo.harga||''}" onchange="updatePromo(${index},'harga',this.value)">
      <input type="text" placeholder="Kategori Promo" value="${promo.kategori||''}" onchange="updatePromo(${index},'kategori',this.value)">
      <input type="date" value="${promo.tanggalAkhir||''}" onchange="updatePromo(${index},'tanggalAkhir',this.value)">
      <button class="btn-danger" onclick="hapusPromo(${index})">Hapus</button>
    `;
    container.appendChild(div);
  });
}

function tambahPromo(promo={}) {
  menuPromo.push({
    namaPromo: promo.namaPromo||"",
    image: promo.image||"",
    namaMenu: promo.namaMenu||"",
    deskripsi: promo.deskripsi||"",
    harga: promo.harga||"",
    kategori: promo.kategori||"",
    tanggalAkhir: promo.tanggalAkhir||"",
  });
  renderPromoUI();
}

function updatePromo(index,key,value){if(menuPromo[index]) menuPromo[index][key]=value;}
function hapusPromo(index){menuPromo.splice(index,1); renderPromoUI();}

function uploadPromoImage(event,index){
  const file=event.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload = e=>{
    document.getElementById(`promoImgPreview${index}`).src = e.target.result;
    updatePromo(index,"image",e.target.result);
  };
  reader.readAsDataURL(file);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MENU FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tambahMenu(kategori="food",nama="",harga=""){
  const containerId={food:"menuFoodContainer",snack:"menuSnackContainer",drink:"menuDrinkContainer"}[kategori];
  const container=document.getElementById(containerId);
  const div=document.createElement("div");
  div.className="menu-item";
  div.innerHTML=`
    <input type="text" placeholder="Nama Menu" value="${nama}" />
    <input type="number" placeholder="Harga" value="${harga}" />
    <select>
      <option value="food" ${kategori==="food"?"selected":""}>Food</option>
      <option value="snack" ${kategori==="snack"?"selected":""}>Snack</option>
      <option value="drink" ${kategori==="drink"?"selected":""}>Drink</option>
    </select>
    <button class="btn-danger" onclick="this.parentElement.remove()">Hapus</button>
  `;
  container.appendChild(div);
}

function ambilMenu(containerId){
  const container=document.getElementById(containerId);
  const items=container.querySelectorAll(".menu-item");
  const result=[];
  items.forEach(item=>{
    const inputs=item.querySelectorAll("input,select");
    const nama=inputs[0]?.value||"";
    const harga=parseInt(inputs[1]?.value||"0");
    const kategori=inputs[2]?.value||"food";
    if(nama && harga) result.push({nama,harga,kategori});
  });
  return result;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ROOM FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tambahRoom(kategori){
  const containerId={hotel:"roomHotelContainer",meeting:"meetingRoomContainer",package:"packageContainer"}[kategori];
  if(!containerId) return;
  const container=document.getElementById(containerId);
  const wrapper=document.createElement("div");
  wrapper.className="room-form";
  wrapper.innerHTML=`
    <input type="text" class="room-nama" placeholder="Nama" />
    <input type="number" class="room-harga" placeholder="Harga" />
    <textarea class="room-deskripsi" placeholder="Deskripsi"></textarea>
    <div class="gambar-preview-wrapper">
      <img class="gambar-preview" style="display:none;" />
      <button class="hapus-gambar" onclick="hapusGambarRoom(this)" style="display:none;">Ã—</button>
    </div>
    <button class="btn-success room-image-upload" onclick="uploadGambarRoom(this)">ğŸ–¼ï¸ Upload Gambar</button>
    <button class="btn-danger" onclick="hapusFormRoom(this)">ğŸ—‘ï¸ Hapus Room</button>
  `;
  container.appendChild(wrapper);
}

function ambilSemuaRoom(){
  const kategoriIds=[{id:"roomHotelContainer",kategori:"hotel"},{id:"meetingRoomContainer",kategori:"meeting"},{id:"packageContainer",kategori:"package"}];
  const hasil=[];
  kategoriIds.forEach(({id,kategori})=>{
    const container=document.getElementById(id);
    if(!container) return;
    container.querySelectorAll(".room-form").forEach(form=>{
      const nama=form.querySelector(".room-nama")?.value||"";
      const deskripsi=form.querySelector(".room-deskripsi")?.value||"";
      const harga=parseInt(form.querySelector(".room-harga")?.value||"0");
      const image=form.querySelector(".room-image-upload")?.getAttribute("data-image")||"";
      if(nama && harga) hasil.push({nama,deskripsi,harga,image,kategori});
    });
  });
  return hasil;
}

function restoreRoomFromData(rooms=[]){
  rooms.forEach(room=>{
    tambahRoom(room.kategori);
    const containerId={hotel:"roomHotelContainer",meeting:"meetingRoomContainer",package:"packageContainer"}[room.kategori];
    const container=document.getElementById(containerId);
    const forms=container.querySelectorAll(".room-form");
    const lastForm=forms[forms.length-1];
    if(!lastForm) return;
    lastForm.querySelector(".room-nama").value=room.nama||"";
    lastForm.querySelector(".room-deskripsi").value=room.deskripsi||"";
    lastForm.querySelector(".room-harga").value=room.harga||"";
    const preview=lastForm.querySelector(".gambar-preview");
    const hapusBtn=lastForm.querySelector(".hapus-gambar");
    const uploadBtn=lastForm.querySelector(".room-image-upload");
    if(room.image){
      preview.src=room.image;
      preview.style.display="block";
      hapusBtn.style.display="flex";
      uploadBtn.setAttribute("data-image",room.image);
    }
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IMAGE & FLIPBOOK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderImagePreview(tipe,url){
  const img=document.createElement("img");
  img.src=url;
  img.style.maxWidth="100px";
  img.style.margin="5px";
  img.style.borderRadius="5px";
  const wrapper=document.createElement("div");
  wrapper.style.display="inline-block";
  wrapper.style.position="relative";
  wrapper.style.margin="5px";
  const btnHapus=document.createElement("button");
  btnHapus.className="btn-hapus-gambar";
  btnHapus.innerHTML="Ã—";
  btnHapus.style.position="absolute";
  btnHapus.style.top="4px";
  btnHapus.style.right="4px";
  btnHapus.onclick=()=>{wrapper.remove();if(tipe==="ruangan") flipbookRuanganImages=flipbookRuanganImages.filter(s=>s!==url); else flipbookMenuImages=flipbookMenuImages.filter(s=>s!==url);};
  wrapper.appendChild(img);
  wrapper.appendChild(btnHapus);
  const previewContainer=tipe==="ruangan"?"flipbookRuanganPreview":"flipbookMenuPreview";
  document.getElementById(previewContainer).appendChild(wrapper);
  if(tipe==="ruangan") flipbookRuanganImages.push(url);
  else flipbookMenuImages.push(url);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FIRESTORE SAVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function saveToFirestore(data){
  try{
    await setDoc(doc(firestore,"menuva","data"),data);
    console.log("Data tersimpan di Firestore âœ…");
  }catch(err){console.error("Gagal simpan Firestore",err);}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SAVE ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function simpanSemua(){
  const identitas={
    namaRestoran: document.getElementById("restoName")?.value||"",
    nomorWA: document.getElementById("restoWA")?.value||"",
    logo: document.getElementById("logoPreview")?.src||"",
  };
  const menus=[
    ...ambilMenu("menuFoodContainer"),
    ...ambilMenu("menuSnackContainer"),
    ...ambilMenu("menuDrinkContainer"),
  ];
  const rooms=ambilSemuaRoom();
  const data={identitas,menu:menus,promo:menuPromo,rooms,flipbookRuangan:flipbookRuanganImages,flipbookMenu:flipbookMenuImages};
  try{
    await saveDataToDB(data);
    await saveToFirestore(data);
    alert("âœ… Data tersimpan di IndexedDB + Firestore");
  }catch(err){console.error(err);alert("âŒ Gagal simpan data");}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LOAD DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadSemuaData(){
  try{
    const data=await loadDataFromDB();
    if(!data||Object.keys(data).length===0) return;
    document.getElementById("restoName").value=data.identitas?.namaRestoran||"";
    document.getElementById("restoWA").value=data.identitas?.nomorWA||"";
    if(data.identitas?.logo) document.getElementById("logoPreview").src=data.identitas.logo;
    menuPromo=data.promo||[];
    renderPromoUI();
    ["menuFoodContainer","menuSnackContainer","menuDrinkContainer"].forEach(id=>document.getElementById(id).innerHTML="");
    (data.menu||[]).forEach(m=>tambahMenu(m.kategori,m.nama,m.harga));
    restoreRoomFromData(data.rooms||[]);
    flipbookRuanganImages=data.flipbookRuangan||[];
    flipbookMenuImages=data.flipbookMenu||[];
    flipbookRuanganImages.forEach(url=>renderImagePreview("ruangan",url));
    flipbookMenuImages.forEach(url=>renderImagePreview("menu",url));
    console.log("Data berhasil dimuat âœ…");
  }catch(err){console.error("Gagal load data",err);}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BACKUP & RESTORE JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function backupData(){
  loadDataFromDB().then(data=>{
    const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download="menuva_backup.json";
    a.click();
    URL.revokeObjectURL(url);
  }).catch(err=>console.error(err));
}

function initRestoreListener(){
  const restoreInput=document.getElementById("restoreFileInput");
  if(!restoreInput) return;
  restoreInput.addEventListener("change",async e=>{
    const file=e.target.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=async ev=>{
      try{
        const json=JSON.parse(ev.target.result);
        await saveDataToDB(json);
        await loadSemuaData();
        alert("âœ… Data berhasil direstore!");
      }catch(err){console.error(err); alert("âŒ File JSON tidak valid!");}
    };
    reader.readAsText(file);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.onload=async()=>{
  await initDB();
  await loadSemuaData();
  document.getElementById("btnSimpan").onclick=simpanSemua;
  document.getElementById("btnTambahPromo").onclick=()=>tambahPromo();
  document.getElementById("btnBackup").onclick=backupData;
  initRestoreListener();
};
</script>

  <div class="fixed-bar">
  <button onclick="window.location.href='index.html'" class="btn-success">ğŸ”’ Logout</button>
  <button onclick="resetData()" class="btn-danger">ğŸ—‘ï¸ Reset Semua Data</button>
  </div>
  
</body>
</html>














































































