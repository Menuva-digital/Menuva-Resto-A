<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
   * { box-sizing: border-box; }
       body {
      font-family: Arial, sans-serif;
      padding: 20px;
      padding-bottom: 90px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2,h3 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
      background: linear-gradient(135deg, #7f5af0, #2cb5e8);
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
     .btn-plus {
      background-color: #87CEFA;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}
.room-section > div:nth-child(2) button {
  padding: 6px 14px;
  border-radius: 6px;
  background-color: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
.room-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.room-form {
  padding: 10px;
  border: 1px dashed #ccc;
  margin-bottom: 12px;
  border-radius: 6px;
  background-color: #fff;
}
.room-form input[type="text"],
.room-form input[type="number"],
.room-form input[type="file"] {
  display: block;
  margin-bottom: 8px;
  width: 100%;
  padding: 6px;
  font-size: 14px;
}
.room-form .room-preview img {
  max-height: 80px;
  margin-top: 4px;
}

.gambar-preview-wrapper {
  position: relative;
  display: inline-block;
  margin-top: 10px;
}

.gambar-preview {
  height: auto !important;
  width: auto !important;
  max-height: 200px !important; /* Ubah sesuai keinginan */
  max-width: 100% !important;
  display: block;
}
.hapus-gambar {
  position: absolute;
  top: -8px;
  right: -8px;
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 14px;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  transition: background 0.2s;
}

.hapus-gambar:hover {
  background: #cc0000;
}
  .btn-hapus-gambar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: none;
  background: red;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: background 0.2s, transform 0.1s ease;
}

.btn-hapus-gambar:hover {
  background: #cc0000;
  transform: scale(1.05);
}

.section-box {
  border: none;
  padding: 16px;
  margin-bottom: 24px;
  border-radius: 8px;
  background: #fff;
}

.section-box h2,
.section-box h3 {
  margin-top: 0;
}

.room-section {
  margin-bottom: 20px;
}

.room-section button {
  margin-bottom: 10px;
  background-color: #CAE1FF;
}
.btn-simpan {
    background-color: #17a2b8;
    color: white;
    font-weight: bold;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
  }
    /* üîÆ Tombol Tambah - Ungu/Biru Neon */
.btn-tambah-room {
  background: linear-gradient(135deg, #7f5af0, #2cb5e8);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(127, 90, 240, 0.3);
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-tambah-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(44, 181, 232, 0.5);
}
.btn-hapus-room {
  background: linear-gradient(135deg, #ff6b6b, #fbc687);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
  margin-top: 10px;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-hapus-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(251, 198, 135, 0.5);
}

/* üñºÔ∏è Upload Gambar - Sky Blue Gradient */
.btn-upload-gambar {
  background: linear-gradient(135deg, #00c6ff, #0072ff);
  color: white;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  margin-top: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.3s ease;
}
.btn-upload-gambar:hover {
  opacity: 0.85;
}

    /* Fixed button bar bawah layar */
    .fixed-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #ddd;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 10px 20px;
      z-index: 10000;
    }
    .fixed-bar button {
      flex: 1;
      padding: 10px 0;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: white;
    }
    .btn-order {
      background-color: #007bff;
    }
    .btn-order:hover {
      background-color: #0056b3;
    }
    .btn-room {
      background-color: #28a745;
    }
    .btn-room:hover {
      background-color: #1e7e34;
    }

    @media (max-width: 480px) {
      .fixed-bar {
        flex-direction: column;
        padding: 10px;
        gap: 8px;
      }
      .fixed-bar button {
        width: 100%;
        margin: 0;
      }
      .fixed-bar button:last-child {
        margin-bottom: 0;
      }
    }

    
  </style>
</head>
<body>

 <!-- Logo -->
<div class="menuva-logo">
  <img src="menuva-logo.png" alt="Logo Menuva">
</div>

<!-- Identitas Restoran -->
<div class="section">
  <h2>üìá Identitas Restoran</h2>
  <input type="file" id="logoInput" accept="image/*" onchange="handleImageUpload(event,'previewLogo')"/>
  <img id="previewLogo" src="" alt="Logo Restoran"/>
  <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
  <input type="text" id="restoAddress" placeholder="Alamat Restoran" />
  <input type="text" id="restoPhone" placeholder="No. Telepon" />
</div>

<!-- Menu Promo Fix -->
<div class="section">
  <h2>üî• Menu Promo</h2>
  <input type="text" id="promoNama" placeholder="Nama Promo">
  <input type="text" id="promoHarga" placeholder="Harga Promo">
  <input type="text" id="promoDesc" placeholder="Deskripsi Promo">
  <div id="promoContainer"></div>
  <button class="btn-orange" onclick="
    tambahPromo(
      document.getElementById('promoNama').value,
      document.getElementById('promoHarga').value,
      document.getElementById('promoDesc').value
    )
  ">+ Tambah Menu Promo</button>
</div>

<!-- Food Menu Fix -->
<div class="section">
  <h2>üìã FOOD MENU</h2>
  <input type="text" id="menuFoodNama" placeholder="Nama Menu Food">
  <input type="text" id="menuFoodHarga" placeholder="Harga Menu Food">
  <div id="menuFoodContainer"></div>
  <button class="btn-success" onclick="
    tambahMenu('food',
      document.getElementById('menuFoodNama').value,
      document.getElementById('menuFoodHarga').value
    )
  ">+ Tambah Menu</button>
</div>

<!-- Snack Menu Fix -->
<div class="section">
  <h2>üìã SNACK & DESSERT</h2>
  <input type="text" id="menuSnackNama" placeholder="Nama Menu Snack">
  <input type="text" id="menuSnackHarga" placeholder="Harga Menu Snack">
  <div id="menuSnackContainer"></div>
  <button class="btn-success" onclick="
    tambahMenu('snack',
      document.getElementById('menuSnackNama').value,
      document.getElementById('menuSnackHarga').value
    )
  ">+ Tambah Menu</button>
</div>

<!-- Drink Menu Fix -->
<div class="section">
  <h2>üìã DRINK</h2>
  <input type="text" id="menuDrinkNama" placeholder="Nama Menu Drink">
  <input type="text" id="menuDrinkHarga" placeholder="Harga Menu Drink">
  <div id="menuDrinkContainer"></div>
  <button class="btn-success" onclick="
    tambahMenu('drink',
      document.getElementById('menuDrinkNama').value,
      document.getElementById('menuDrinkHarga').value
    )
  ">+ Tambah Menu</button>
</div>

<!-- Nomor WhatsApp Admin Fix -->
<div class="section-box" id="waContainerBox">
  <h3>üì± Nomor WhatsApp Admin (Penerima Pesanan/Reservasi)</h3>
  <input type="text" id="inputNomorWa" placeholder="Contoh: 6281234567890">
  <div id="nomorWaContainer"></div>
  <button onclick="tambahNomorWa(document.getElementById('inputNomorWa').value)">+ Tambah Nomor WA</button>
</div>

<!-- Room / Package Fix -->
<div class="section-box" id="roomContainerBox">
  <h2>üè® Room / Package</h2>

  <!-- Room Hotel -->
  <div class="room-section">
    <h3>üõèÔ∏è Room Hotel</h3>
    <input type="text" id="roomHotelNama" placeholder="Nama Room Hotel">
    <input type="number" id="roomHotelKapasitas" placeholder="Kapasitas">
    <div id="roomHotelContainer"></div>
    <button onclick="
      tambahRoom('hotel',
        document.getElementById('roomHotelNama').value,
        document.getElementById('roomHotelKapasitas').value
      )
    ">+ Tambah Room Hotel</button>
  </div>

  <!-- Meeting Room -->
  <div class="room-section">
    <h3>üíº Meeting Room</h3>
    <input type="text" id="roomMeetingNama" placeholder="Nama Meeting Room">
    <input type="number" id="roomMeetingKapasitas" placeholder="Kapasitas">
    <div id="meetingRoomContainer"></div>
    <button onclick="
      tambahRoom('meeting',
        document.getElementById('roomMeetingNama').value,
        document.getElementById('roomMeetingKapasitas').value
      )
    ">+ Tambah Meeting Room</button>
  </div>

  <!-- Package -->
  <div class="room-section">
    <h3>üéÅ Package</h3>
    <input type="text" id="packageNama" placeholder="Nama Package">
    <input type="number" id="packageKapasitas" placeholder="Kapasitas / Jumlah">
    <div id="packageContainer"></div>
    <button onclick="
      tambahRoom('package',
        document.getElementById('packageNama').value,
        document.getElementById('packageKapasitas').value
      )
    ">+ Tambah Package</button>
  </div>

  <hr>
  <div class="section">
    <button class="btn-simpan" onclick="simpanData()">üíæ Simpan Semua</button>
    <button onclick="window.open('menu.html')" style="margin-top: 10px;" class="btn-orange">üëÅÔ∏è Lihat Halaman Customer</button>
    <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: rgb(58, 82, 219); color: white; padding: 10px; border: none; border-radius: 8px; margin-top: 10px;">
      üìã Copy Link Untuk Dibagikan Ke Customers
    </button>
    
    <!-- Backup dan Restore -->

    <div class="section">
      <h2>üîÅ Backup & Restore Data</h2>
     <button onclick="backupData()">üì¶ Backup Data</button>

     <!-- Tempat status -->
     <div id="backupDownloadLink" style="margin-top:10px;"></div>

      
      <!-- Input Restore -->
      <label for="restoreInput" style="margin-top: 20px; display: block;">
        üìÇ Pilih File JSON untuk Restore:
      </label>
      <input type="file" id="restoreInput" accept=".json" onchange="restoreDataFromFile(event)" />
    </div>
  
  <div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
    <strong>Panduan Penggunaan:</strong><br>
    PENTING!!<br>
    üîπ Klik <strong>‚¨áÔ∏è Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
    üîπ Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
    üîπ Klik <strong>üìÇ Pilih File</strong untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
    ‚ö†Ô∏è Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
    üí° Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
  </div>
</div>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

<script type="text/javascript">
/* =========================
   Firebase Init
========================= */
const firebaseConfig = {
  apiKey: "AIzaSyBxKnIO_cIX8B94608zdx5uGs_o4M7ctEk",
  authDomain: "menuvaresto.firebaseapp.com",
  projectId: "menuvaresto",
  storageBucket: "menuvaresto.appspot.com",
  messagingSenderId: "576149783998",
  appId: "1:576149783998:web:7ace26d67b02d45226e5ef"
};
const app = firebase.initializeApp(firebaseConfig);
const firestore = firebase.firestore(app);

/* =========================
   IndexedDB Helpers
========================= */
const DB_NAME = "menuvaDB";
const STORE   = "menuvaData";
const FIX_ID  = "menuvaData";

function openDB() {
  return new Promise((resolve,reject)=>{
    const req = indexedDB.open(DB_NAME,1);
    req.onupgradeneeded = (e)=>{
      const db = e.target.result;
      if(!db.objectStoreNames.contains(STORE)) db.createObjectStore(STORE,{keyPath:"id"});
    };
    req.onsuccess = (e)=>resolve(e.target.result);
    req.onerror = ()=>reject(req.error);
  });
}

async function saveDataToDB(data){
  if(!data.id) data.id=FIX_ID;
  const db = await openDB();
  return new Promise((resolve,reject)=>{
    const tx = db.transaction(STORE,"readwrite");
    const store = tx.objectStore(STORE);
    const clearReq = store.clear();
    clearReq.onsuccess = ()=>{
      const putReq = store.put(data);
      putReq.onsuccess = ()=>{db.close();resolve(true)};
      putReq.onerror   = ()=>{db.close();reject(putReq.error)};
    };
    clearReq.onerror = ()=>{db.close();reject(clearReq.error)};
  });
}

async function loadDataFromDB(){
  const db = await openDB();
  return new Promise((resolve,reject)=>{
    const tx = db.transaction(STORE,"readonly");
    const store = tx.objectStore(STORE);
    const getReq = store.get(FIX_ID);
    getReq.onsuccess = ()=>{db.close();resolve(getReq.result||null)};
    getReq.onerror   = ()=>{db.close();reject(getReq.error)};
  });
}

/* =========================
   Firestore Save
========================= */
async function saveToFirestore(data){
  try{
    await firestore.collection("menuva").doc("data").set(data);
    console.log("Data tersimpan di Firestore ‚úÖ");
  }catch(err){console.error("Gagal simpan Firestore",err);}
}

/* =========================
   Backup & Restore
========================= */
async function backupData(){
  try{
    const data = await loadDataFromDB();
    if(!data){alert("Tidak ada data untuk backup!");return;}
    const filename = `menuva-backup-${Date.now()}.json`;
    const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url;a.download=filename;document.body.appendChild(a);a.click();a.remove();
    const statusDiv = document.getElementById("backupDownloadLink");
    if(statusDiv) statusDiv.innerHTML=`‚úÖ Backup berhasil! File <strong>${filename}</strong> siap di-download.`;
  }catch(err){alert("‚ùå Gagal backup: "+err.message);}
}

function restoreDataFromFile(event){
  const file=event?.target?.files?.[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = async (e)=>{
    try{
      const json = JSON.parse(e.target.result);
      if(!json.id) json.id=FIX_ID;
      await saveDataToDB(json);
      alert("‚úÖ Restore sukses, reload halaman...");
      location.reload();
    }catch(err){console.error("Restore error:",err);alert("‚ùå File JSON invalid!");}
  };
  reader.readAsText(file);
}

/* =========================
   Upload ‚Üí Preview helper
========================= */
function handleImageUpload(e,previewId){
  const file = e?.target?.files?.[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{ const img = document.getElementById(previewId); if(img) img.src=reader.result; };
  reader.readAsDataURL(file);
}

/* =========================
   Global Variables
========================= */
window.menuPromo=[];
window.flipbookRuanganImages=[];
window.flipbookMenuImages=[];
window.nomorWAList=[];
window.roomsList=[];

/* =========================
   Promo / Menu / WA / Rooms
========================= */
window.tambahPromo = function(){
  const nama = prompt("Nama Promo:");
  if(!nama) return alert("Nama promo kosong!");
  const harga = prompt("Harga Promo:");
  const deskripsi = prompt("Deskripsi Promo:");
  window.menuPromo.push({nama,harga,deskripsi});
  renderPromoUI();
};

window.renderPromoUI = function(){
  const promoContainer = document.getElementById("promoContainer");
  if(!promoContainer) return;
  promoContainer.innerHTML="";
  window.menuPromo.forEach(p=>{
    const div=document.createElement("div");
    div.innerText=`${p.nama} - ${p.harga||""} - ${p.deskripsi||""}`;
    promoContainer.appendChild(div);
  });
};

window.tambahMenu = function(kategori){
  const nama = prompt("Nama Menu:");
  if(!nama) return alert("Nama menu kosong!");
  const harga = prompt("Harga Menu:");
  const id = "menu"+kategori.charAt(0).toUpperCase()+kategori.slice(1)+"Container";
  const container=document.getElementById(id);
  if(container){
    const div=document.createElement("div");
    div.innerText=`${nama} - ${harga||""}`;
    container.appendChild(div);
  }
};

window.tambahNomorWa = function(){
  const input = document.querySelector("#nomorWaContainer input");
  const nomor = input?.value.trim();
  if(!nomor) return alert("Nomor WA kosong!");
  window.nomorWAList.push(nomor);
  const container=document.getElementById("nomorWaContainer");
  const div=document.createElement("div");
  div.innerText=nomor;
  container.appendChild(div);
  input.value="";
};

window.tambahRoom = function(tipe){
  const nama = prompt("Nama "+tipe+" :");
  if(!nama) return alert("Nama room kosong!");
  window.roomsList.push({tipe,nama});
  const containerMap={
    hotel: document.getElementById("roomHotelContainer"),
    meeting: document.getElementById("meetingRoomContainer"),
    package: document.getElementById("packageContainer")
  };
  const container=containerMap[tipe];
  if(container){
    const div=document.createElement("div");
    div.innerText=nama;
    container.appendChild(div);
  }
};

/* =========================
   Gambar Ruangan & Menu (pakai file input tersembunyi)
========================= */
window.tambahGambar = function(type){
  const inputId = type === "ruangan" ? "flipbookRuanganUpload" : "flipbookMenuUpload";
  const inputEl = document.getElementById(inputId);
  if(!inputEl) return;
  inputEl.click();
};

function bacaFileListKeDataURL(fileList){
  return Promise.all(
    Array.from(fileList).map(f => new Promise((res,rej)=>{
      const r = new FileReader();
      r.onload = ()=>res(r.result);
      r.onerror = rej;
      r.readAsDataURL(f);
    }))
  );
}

function renderImagePreview(type, arr){
  const containerId = (type==="ruangan") ? "flipbookRuanganPreview" : "flipbookMenuPreview";
  const container=document.getElementById(containerId);
  if(!container) return;
  container.innerHTML="";
  (arr||[]).forEach(u=>{
    const img=document.createElement("img");
    img.src=u;
    img.style.width="80px"; img.style.height="80px"; img.style.margin="4px";
    container.appendChild(img);
  });
}

/* =========================
   Simpan Semua Data
========================= */
async function simpanData(){
  const identitas={
    namaRestoran: document.getElementById("namaRestoran")?.value||"",
    nomorWA: window.nomorWAList,
    logo: document.getElementById("previewLogo")?.src||""
  };
  const data={
    id:FIX_ID,
    identitas,
    promo: window.menuPromo,
    rooms: window.roomsList,
    flipbookRuangan: window.flipbookRuanganImages,
    flipbookMenu: window.flipbookMenuImages
  };
  try{
    await saveDataToDB(data);
    await saveToFirestore(data);
    alert("‚úÖ Data tersimpan!");
  }catch(err){console.error(err);alert("‚ùå Gagal simpan!");}
}

/* =========================
   Load Semua Data
========================= */
async function loadSemuaData(){
  try{
    const data=await loadDataFromDB();
    if(!data) return;

    // Identitas
    const namaInput = document.getElementById("namaRestoran");
    const logoImg   = document.getElementById("previewLogo");
    if(namaInput) namaInput.value = data.identitas?.namaRestoran || "";
    if(logoImg)   logoImg.src     = data.identitas?.logo || "";

    // Promo
    window.menuPromo = data.promo || [];
    renderPromoUI();

    // Nomor WA
    window.nomorWAList = data.identitas?.nomorWA || data.nomorWA || [];
    const waContainer = document.getElementById("nomorWaContainer");
    if(waContainer){
      // pertahankan 1 input pertama, hapus sisanya
      const firstInput = waContainer.querySelector("input");
      waContainer.innerHTML = "";
      if(firstInput) waContainer.appendChild(firstInput);
      window.nomorWAList.forEach(n => {
        const div = document.createElement("div");
        div.innerText = n;
        waContainer.appendChild(div);
      });
    }

    // Rooms
    window.roomsList = data.rooms || [];
    const roomContainers = {
      hotel: document.getElementById("roomHotelContainer"),
      meeting: document.getElementById("meetingRoomContainer"),
      package: document.getElementById("packageContainer")
    };
    Object.values(roomContainers).forEach(c=>{ if(c) c.innerHTML=""; });
    window.roomsList.forEach(r => {
      const container = roomContainers[r.tipe];
      if(container){
        const div = document.createElement("div");
        div.innerText = r.nama;
        container.appendChild(div);
      }
    });

    // Flipbook
    window.flipbookRuanganImages = data.flipbookRuangan || [];
    window.flipbookMenuImages = data.flipbookMenu || [];
    renderImagePreview("ruangan", window.flipbookRuanganImages);
    renderImagePreview("menu", window.flipbookMenuImages);

    console.log("Data berhasil dimuat ‚úÖ");
  }catch(err){console.error("Gagal load data",err);}
}

/* =========================
   Util lain (biar gak error tombol bawah)
========================= */
async function resetData(){
  const ok = confirm("Yakin reset semua data? Tindakan ini tidak bisa dibatalkan.");
  if(!ok) return;
  // Bersihkan IndexedDB
  const db = await openDB();
  await new Promise((res,rej)=>{
    const tx = db.transaction(STORE,"readwrite");
    tx.objectStore(STORE).clear().onsuccess = ()=>{db.close();res()};
    tx.onerror = ()=>{db.close();rej(tx.error)};
  });
  // Bersihkan state & UI
  window.menuPromo=[];
  window.flipbookRuanganImages=[];
  window.flipbookMenuImages=[];
  window.nomorWAList=[];
  window.roomsList=[];
  document.getElementById("namaRestoran").value="";
  document.getElementById("previewLogo").src="";
  ["promoContainer","roomHotelContainer","meetingRoomContainer","packageContainer",
   "flipbookRuanganPreview","flipbookMenuPreview"].forEach(id=>{
     const el=document.getElementById(id); if(el) el.innerHTML="";
  });
  const waContainer=document.getElementById("nomorWaContainer");
  if(waContainer){
    waContainer.innerHTML="";
    const input=document.createElement("input");
    input.type="text"; input.className="nomor-wa"; input.placeholder="Contoh: 6281234567890";
    waContainer.appendChild(input);
  }
  alert("Data sudah direset.");
}

function salinLinkMenu(){
  const url = location.origin + "/menu.html";
  navigator.clipboard?.writeText(url).then(()=>{
    alert("Link disalin: " + url);
  }).catch(()=>{
    prompt("Salin link berikut:", url);
  });
}

/* =========================
   Auto Init & Event Binding
========================= */
window.backupData = backupData;
window.restoreDataFromFile = restoreDataFromFile;
window.handleImageUpload = handleImageUpload;
window.simpanData = simpanData;
window.resetData = resetData;
window.salinLinkMenu = salinLinkMenu;

// Bind input logo ‚Üí preview
document.addEventListener("DOMContentLoaded",()=>{
  const logoInput = document.getElementById("logoInput");
  if(logoInput){
    logoInput.addEventListener("change",(e)=>handleImageUpload(e,"previewLogo"));
  }

  // Bind upload ruangan/menu ‚Üí simpan ke array + render
  const rInput = document.getElementById("flipbookRuanganUpload");
  const mInput = document.getElementById("flipbookMenuUpload");
  if(rInput){
    rInput.addEventListener("change", async (e)=>{
      const urls = await bacaFileListKeDataURL(e.target.files||[]);
      window.flipbookRuanganImages.push(...urls);
      renderImagePreview("ruangan", window.flipbookRuanganImages);
      rInput.value = "";
    });
  }
  if(mInput){
    mInput.addEventListener("change", async (e)=>{
      const urls = await bacaFileListKeDataURL(e.target.files||[]);
      window.flipbookMenuImages.push(...urls);
      renderImagePreview("menu", window.flipbookMenuImages);
      mInput.value = "";
    });
  }

  loadSemuaData();
});

window.addEventListener("error",(e)=>{console.error("Global error:",e?.error||e?.message);});
</script>


  <div class="fixed-bar">
  <button onclick="window.location.href='index.html'" class="btn-success">üîí Logout</button>
  <button onclick="resetData()" class="btn-danger">üóëÔ∏è Reset Semua Data</button>
  </div>
  
</body>
</html>





























































































