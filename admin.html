<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2,h3 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
      backgound-color: #40E0D0;
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}
.room-section > div:nth-child(2) button {
  padding: 6px 14px;
  border-radius: 6px;
  background-color: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
.room-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.room-form {
  padding: 10px;
  border: 1px dashed #ccc;
  margin-bottom: 12px;
  border-radius: 6px;
  background-color: #fff;
}
.room-form input[type="text"],
.room-form input[type="number"],
.room-form input[type="file"] {
  display: block;
  margin-bottom: 8px;
  width: 100%;
  padding: 6px;
  font-size: 14px;
}
.room-form .room-preview img {
  max-height: 80px;
  margin-top: 4px;
}

.gambar-preview-wrapper {
  position: relative;
  display: inline-block;
  margin-top: 10px;
}

.gambar-preview {
  height: auto !important;
  width: auto !important;
  max-height: 200px !important; /* Ubah sesuai keinginan */
  max-width: 100% !important;
  display: block;
}
.hapus-gambar {
  position: absolute;
  top: -8px;
  right: -8px;
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 14px;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  transition: background 0.2s;
}

.hapus-gambar:hover {
  background: #cc0000;
}
  .btn-hapus-gambar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: none;
  background: red;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: background 0.2s, transform 0.1s ease;
}

.btn-hapus-gambar:hover {
  background: #cc0000;
  transform: scale(1.05);
}

.section-box {
  border: none;
  padding: 16px;
  margin-bottom: 24px;
  border-radius: 8px;
  background: #fff;
}

.section-box h2,
.section-box h3 {
  margin-top: 0;
}

.room-section {
  margin-bottom: 20px;
}

.room-section button {
  margin-bottom: 10px;
  backgound-color: #40E0D0;
}


  </style>
</head>
<body>

  <div class="menuva-logo">
    <img src="menuva-logo.png" alt="Logo Menuva">
  </div>

  <div class="section">
    <h2>ğŸ“‡ Identitas Restoran</h2>
    <input type="file" id="logoInput" accept="image/*" />
    <img id="previewLogo" src="" alt="Logo Restoran" style="max-height: 80px; margin-top: 10px;" />
    <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
    <label for="restoAddress">Alamat Restoran</label>
    <input id="restoAddress" type="text" placeholder="Jl. Sudirman No. 10, Jakarta" />
    <label for="restoPhone">No. Telepon</label>
    <input id="restoPhone" type="text" placeholder="08xx-xxxx-xxxx" />
  </div>

  <div class="section">
    <h2>ğŸ”¥ Menu Promo</h2>
    <div id="promoContainer"></div>
    <button class="btn-orange" onclick="tambahPromo()">+ Tambah Menu Promo</button>
  </div>

  <div class="section">
    <h2>ğŸ“‹ FOOD MENU</h2>
    <div id="menuFoodContainer"></div>
    <button class="btn-success" onclick="tambahMenu('food')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ SNACK & DESSERT</h2>
    <div id="menuSnackContainer"></div>
    <button class="btn-success" onclick="tambahMenu('snack')">+ Tambah Menu</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ DRINK</h2>
    <div id="menuDrinkContainer"></div>
    <button class="btn-success" onclick="tambahMenu('drink')">+ Tambah Menu</button>
  </div>
  
  <!-- ğŸ“± Nomor WhatsApp Admin -->
<div class="section-box" id="waContainerBox">
  <h3>ğŸ“± Nomor WhatsApp Admin (Penerima Pesanan/Reservasi)</h3>
  <div id="nomorWaContainer">
    <input type="text" class="nomor-wa" placeholder="Contoh: 6281234567890">
  </div>
  <button onclick="tambahNomorWa()">+ Tambah Nomor WA</button>
</div>
  
 <div class="section">
  <h2>ğŸ“¸ Galeri Ruangan</h2>
  <button onclick="tambahGambar('ruangan')">+ Tambah Gambar Ruangan</button>
  <input type="file" id="flipbookRuanganUpload" accept="image/*" multiple style="display:none;" />
  <div id="flipbookRuanganPreview"></div>
</div>

<div class="section">
  <h2>ğŸ“– Menu Restoran</h2>
  <button onclick="tambahGambar('menu')">+ Tambah Gambar Menu</button>
  <input type="file" id="flipbookMenuUpload" accept="image/*" multiple style="display:none;" />
  <div id="flipbookMenuPreview"></div>
</div>

<!-- ğŸ¨ Room / Package -->
<div class="section-box" id="roomContainerBox">
  <h2>ğŸ¨ Room / Package</h2>

  <!-- Room Hotel -->
  <div class="room-section">
    <h3>ğŸ›ï¸ Room Hotel</h3>
    <button onclick="tambahRoom('hotel')">+ Tambah Room Hotel</button>
    <div id="roomHotelContainer"></div>
  </div>

  <!-- Meeting Room -->
  <div class="room-section">
    <h3>ğŸ’¼ Meeting Room</h3>
    <button onclick="tambahRoom('meeting')">+ Tambah Meeting Room</button>
    <div id="meetingRoomContainer"></div>
  </div>

  <!-- Package -->
  <div class="room-section">
    <h3>ğŸ Package</h3>
    <button onclick="tambahRoom('package')">+ Tambah Package</button>
    <div id="packageContainer"></div>
  </div>
</div>


</form>

<hr>
  <div class="section">
    <button onclick="simpanData()">ğŸ’¾ Simpan Semua</button>
    <button onclick="window.open('menu.html')" style="margin-top: 10px;">ğŸ‘ï¸ Lihat Halaman Customer</button>
    <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: rgb(58, 82, 219); color: white; padding: 10px; border: none; border-radius: 8px; margin-top: 10px;">
      ğŸ“‹ Copy Link Untuk Dibagikan Ke Customers
    </button>
    
    <!-- Backup dan Restore -->

    <div class="section">
      <h2>ğŸ” Backup & Restore Data</h2>
     <button onclick="backupData()">ğŸ“¦ Backup Data</button>

     <!-- Tempat status -->
     <div id="backupDownloadLink" style="margin-top:10px;"></div>

      
      <!-- Input Restore -->
      <label for="restoreInput" style="margin-top: 20px; display: block;">
        ğŸ“‚ Pilih File JSON untuk Restore:
      </label>
      <input type="file" id="restoreInput" accept=".json" onchange="restoreDataFromFile(event)" />
    </div>
  
  <div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
    <strong>Panduan Penggunaan:</strong><br>
    PENTING!!<br>
    ğŸ”¹ Klik <strong>â¬‡ï¸ Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
    ğŸ”¹ Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
    ğŸ”¹ Klik <strong>ğŸ“‚ Pilih File</strong untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
    âš ï¸ Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
    ğŸ’¡ Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
  </div>
</div>

    <button onclick="window.location.href='index.html'" class="btn-secondary" style="margin-top: 10px;">ğŸ”’ Logout</button>
    <button onclick="resetData()" class="btn-danger" style="margin-top: 10px;">ğŸ—‘ï¸ Reset Semua Data</button>
  </div>
  <script>
    let db;
    const DB_NAME = "MenuvaDB";
    const STORE_NAME = "menuvaData";
    const DB_VERSION = 1;
  
    // Inisialisasi IndexedDB
    function initDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);

    request.onerror = () => reject(request.error);

    request.onupgradeneeded = (event) => {
      db = event.target.result;

      if (!db.objectStoreNames.contains("menuvaData")) {
        db.createObjectStore("menuvaData", { keyPath: "id" });
      }

      if (!db.objectStoreNames.contains("roomData")) {
        db.createObjectStore("roomData", { keyPath: "id", autoIncrement: true });
      }
    };

    request.onsuccess = (event) => {
      db = event.target.result;
      resolve();
    };
  });
}

  
    // Simpan data ke IndexedDB
    function saveDataToDB(data) {
      return new Promise((resolve, reject) => {
        if (!db) return reject(new Error("DB belum diinisialisasi"));
  
        const tx = db.transaction(STORE_NAME, "readwrite");
        const store = tx.objectStore(STORE_NAME);
        const putReq = store.put({ id: 1, ...data });
  
        putReq.onsuccess = () => resolve();
        putReq.onerror = () => reject(putReq.error);
        tx.onerror = () => reject(tx.error);
      });
    }
  
    // Load data dari IndexedDB
    function loadDataFromDB() {
      return new Promise((resolve, reject) => {
        if (!db) return reject(new Error("DB belum diinisialisasi"));
  
        const tx = db.transaction(STORE_NAME, "readonly");
        const store = tx.objectStore(STORE_NAME);
        const getReq = store.get(1);
  
        getReq.onsuccess = () => resolve(getReq.result || {});
        getReq.onerror = () => reject(getReq.error);
        tx.onerror = () => reject(tx.error);
      });
    }
  
    // Hapus semua data
    function clearDataDB() {
      return new Promise((resolve, reject) => {
        if (!db) return reject(new Error("DB belum diinisialisasi"));
  
        const tx = db.transaction(STORE_NAME, "readwrite");
        const store = tx.objectStore(STORE_NAME);
        const clearReq = store.clear();
  
        clearReq.onsuccess = () => resolve();
        clearReq.onerror = () => reject(clearReq.error);
        tx.onerror = () => reject(tx.error);
      });
    }
  
    // Variabel global
    let menuPromo = [];
    let flipbookRuanganImages = [];
    let flipbookMenuImages = [];
  
    // RENDER PROMO
    function renderPromoUI() {
      const container = document.getElementById("promoContainer");
      container.innerHTML = "";
      menuPromo.forEach((promo, index) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <input type="text" placeholder="Nama Promo" value="${promo.namaPromo || ""}" onchange="updatePromo(${index}, 'namaPromo', this.value)">
          <input type="file" accept="image/*" onchange="uploadPromoImage(event, ${index})">
          <img id="promoImgPreview${index}" src="${promo.image || ""}" style="max-height:80px; margin:5px 0">
          <input type="text" placeholder="Nama Menu Promo" value="${promo.namaMenu || ""}" onchange="updatePromo(${index}, 'namaMenu', this.value)">
          <input type="text" placeholder="Deskripsi Promo" value="${promo.deskripsi || ""}" onchange="updatePromo(${index}, 'deskripsi', this.value)">
          <input type="number" placeholder="Harga Promo" value="${promo.harga || ""}" onchange="updatePromo(${index}, 'harga', this.value)">
          <input type="text" placeholder="Kategori Promo" value="${promo.kategori || ""}" onchange="updatePromo(${index}, 'kategori', this.value)">
          <input type="date" value="${promo.tanggalAkhir || ""}" onchange="updatePromo(${index}, 'tanggalAkhir', this.value)">
          <button class="btn-danger" onclick="hapusPromo(${index})">Hapus</button>
        `;
        container.appendChild(div);
      });
    }
  
    function tambahPromo(promo = {}) {
      menuPromo.push({
        namaPromo: promo.namaPromo || "",
        image: promo.image || "",
        namaMenu: promo.namaMenu || "",
        deskripsi: promo.deskripsi || "",
        harga: promo.harga || "",
        kategori: promo.kategori || "",
        tanggalAkhir: promo.tanggalAkhir || "",
      });
      renderPromoUI();
    }
  
    function updatePromo(index, key, value) {
      if (!menuPromo[index]) return;
      menuPromo[index][key] = value;
    }
  
    function hapusPromo(index) {
      menuPromo.splice(index, 1);
      renderPromoUI();
    }
  
    // Upload gambar promo
    function uploadPromoImage(event, index) {
      const file = event.target.files[0];
      if (!file) return;
  
      resizeIfNeeded(file)
        .then((resizedImage) => {
          const preview = document.getElementById(`promoImgPreview${index}`);
          preview.src = resizedImage;
          updatePromo(index, "image", resizedImage);
        })
        .catch((err) => {
          alert("Gagal memproses gambar promo.");
          console.error(err);
        });
    }
  
    // Tambah menu (food, snack, drink)
    function tambahMenu(kategori = "food", nama = "", harga = "") {
      const containerId = {
        food: "menuFoodContainer",
        snack: "menuSnackContainer",
        drink: "menuDrinkContainer",
      }[kategori];
  
      const container = document.getElementById(containerId);
      const div = document.createElement("div");
      div.className = "menu-item";
      div.innerHTML = `
        <input type="text" placeholder="Nama Menu" value="${nama}" />
        <input type="number" placeholder="Harga" value="${harga}" />
        <select>
          <option value="food" ${kategori === "food" ? "selected" : ""}>Food</option>
          <option value="snack" ${kategori === "snack" ? "selected" : ""}>Snack</option>
          <option value="drink" ${kategori === "drink" ? "selected" : ""}>Drink</option>
        </select>
        <button class="btn-danger" onclick="this.parentElement.remove()">Hapus</button>
      `;
      container.appendChild(div);
    }
    
function tambahRoom(kategori) {
  const containerId = {
    hotel: "roomHotelContainer",
    meeting: "meetingRoomContainer",
    package: "packageContainer"
  }[kategori];

  if (!containerId) return;

  const container = document.getElementById(containerId);

  const wrapper = document.createElement("div");
  wrapper.className = "room-form"; // âœ… ini penting
  wrapper.innerHTML = `
    <input type="text" class="room-nama" placeholder="Nama" />
    <input type="number" class="room-harga" placeholder="Harga" />
    <textarea class="room-deskripsi" placeholder="Deskripsi"></textarea>

    <div class="gambar-preview-wrapper">
      <img class="gambar-preview" style="display:none;" />
      <button class="hapus-gambar" onclick="hapusGambarRoom(this)" style="display:none;">Ã—</button>
    </div>

    <button class="room-image-upload" onclick="uploadGambarRoom(this)">ğŸ–¼ï¸ Upload Gambar</button>
  `;
  container.appendChild(wrapper);
}

  async function tampilkanListRoom() {
  try {
    const data = await loadDataFromDB();
    const listContainer = document.getElementById("listRuangan");
    listContainer.innerHTML = ""; // Kosongkan sebelum render ulang

    if (!data.room || data.room.length === 0) {
      listContainer.innerHTML = "<p>Tidak ada ruangan yang tersedia.</p>";
      return;
    }

    data.room.forEach((room, index) => {
      const item = document.createElement("div");
      item.classList.add("room-card");
      item.innerHTML = `
        <strong>Ruangan ${index + 1}</strong><br>
        ğŸ·ï¸ Nama: ${room.nama}<br>
        ğŸ’¼ Kategori: ${room.kategori}<br>
        ğŸ’° Harga: Rp${room.harga}<br>
        ğŸ“ Deskripsi: ${room.deskripsi || "-"}
        <hr>
      `;
      listContainer.appendChild(item);
    });
  } catch (err) {
    console.error("Gagal menampilkan daftar ruangan:", err);
  }
}

   
function uploadGambarRoom(button) {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.style.display = "none";

  input.onchange = function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (event) {
      const wrapper = button.closest(".room-form");
      const preview = wrapper.querySelector(".gambar-preview");
      const hapusBtn = wrapper.querySelector(".hapus-gambar");

      const imageUrl = event.target.result;

      preview.src = imageUrl;
      preview.style.display = "block";
      hapusBtn.style.display = "flex";
      button.setAttribute("data-image", imageUrl); // simpan base64 ke atribut!
    };
    reader.readAsDataURL(file);
  };

  document.body.appendChild(input);
  input.click();
  document.body.removeChild(input);
}

    
function hapusGambarRoom(button) {
  const wrapper = button.closest(".room-form");
  const preview = wrapper.querySelector(".gambar-preview");
  const uploadBtn = wrapper.querySelector(".room-image-upload");

  preview.src = "";
  preview.style.display = "none";
  button.style.display = "none";

  // âœ… hapus data-image juga
  if (uploadBtn) uploadBtn.removeAttribute("data-image");
}

    function ambilSemuaRoom() {
  const kategoriIds = [
    { id: "roomHotelContainer", kategori: "hotel" },
    { id: "meetingRoomContainer", kategori: "meeting" },
    { id: "packageContainer", kategori: "package" }
  ];

  const hasil = [];

  kategoriIds.forEach(({ id, kategori }) => {
    const container = document.getElementById(id);
    if (!container) return;

    const forms = container.querySelectorAll(".room-form");
    forms.forEach(form => {
      const nama = form.querySelector(".room-nama")?.value || "";
      const deskripsi = form.querySelector(".room-deskripsi")?.value || "";
      const harga = parseInt(form.querySelector(".room-harga")?.value || "0");
      const image = form.querySelector(".room-image-upload")?.getAttribute("data-image") || "";

      if (nama && harga) {
        hasil.push({ nama, deskripsi, harga, image, kategori });
      }
    });
  });

  return hasil;
}

    function restoreRoomFromData(rooms = []) {
  rooms.forEach(room => {
    // Buat ulang form berdasarkan kategori
    tambahRoom(room.kategori);

    const containerId = {
      hotel: "roomHotelContainer",
      meeting: "meetingRoomContainer",
      package: "packageContainer"
    }[room.kategori];

    const container = document.getElementById(containerId);
    const forms = container.querySelectorAll(".room-form");
    const lastForm = forms[forms.length - 1]; // ambil form yang baru dibuat

    lastForm.querySelector(".room-nama").value = room.nama || "";
    lastForm.querySelector(".room-deskripsi").value = room.deskripsi || "";
    lastForm.querySelector(".room-harga").value = room.harga || "";

    // restore gambar
    const preview = lastForm.querySelector(".gambar-preview");
    const hapusBtn = lastForm.querySelector(".hapus-gambar");
    const uploadBtn = lastForm.querySelector(".room-image-upload");

    if (room.image) {
      preview.src = room.image;
      preview.style.display = "block";
      hapusBtn.style.display = "flex";
      uploadBtn.setAttribute("data-image", room.image);
    }
  });
}



    // Tambah nomor WA admin
    function tambahNomorWa() {
      const container = document.getElementById("nomorWaContainer");
      const input = document.createElement("input");
      input.type = "text";
      input.className = "nomor-wa";
      input.placeholder = "Contoh: 6281234567890";
      container.appendChild(input);
    }
  
    // Ambil data menu dari UI
    function ambilMenu(containerId) {
      const container = document.getElementById(containerId);
      const items = container.querySelectorAll(".menu-item");
      const result = [];
  
      items.forEach((item) => {
        const inputs = item.querySelectorAll("input, select");
        const nama = inputs[0]?.value || "";
        const harga = parseInt(inputs[1]?.value || "0");
        const kategori = inputs[2]?.value || "food";
  
        if (nama && harga) {
          result.push({ nama, harga, kategori });
        }
      });
  
      return result;
    }
  
    // Resize gambar kalau perlu
    function resizeIfNeeded(file, maxSizeMB = 0.7, maxWidth = 1280, quality = 0.9) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const scale = Math.min(maxWidth / img.width, 1);
            const canvas = document.createElement("canvas");
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            const resized = canvas.toDataURL("image/jpeg", quality);
            resolve(resized);
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
  
    // Upload logo handler
    document
      .getElementById("logoInput")
      .addEventListener("change", async function (e) {
        const file = e.target.files[0];
        if (!file) return;
        try {
          const logoUrl = await resizeIfNeeded(file);
          document.getElementById("previewLogo").src = logoUrl;
        } catch (err) {
          alert("âŒ Gagal memproses gambar logo.");
          console.error("Logo error:", err);
        }
      });
  
    // Render preview gambar flipbook
    function renderImagePreview(tipe, url) {
  const img = document.createElement("img");
  img.src = url;
  img.style.maxWidth = "100px";
  img.style.margin = "5px";
  img.style.borderRadius = "5px";
  img.style.boxShadow = "0 1px 4px rgba(0,0,0,0.1)";

  const wrapper = document.createElement("div");
  wrapper.style.display = "inline-block";
  wrapper.style.position = "relative";
  wrapper.style.margin = "5px";

  const btnHapus = document.createElement("button");
  btnHapus.className = "btn-hapus-gambar";
  btnHapus.setAttribute("aria-label", "Hapus Gambar");

  btnHapus.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
         stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18" />
      <line x1="6" y1="6" x2="18" y2="18" />
    </svg>
  `;

  btnHapus.style.position = "absolute";
  btnHapus.style.top = "4px";
  btnHapus.style.right = "4px";

  btnHapus.onclick = function () {
    wrapper.remove();
    if (tipe === "ruangan") {
      flipbookRuanganImages = flipbookRuanganImages.filter((src) => src !== url);
    } else {
      flipbookMenuImages = flipbookMenuImages.filter((src) => src !== url);
    }
  };

  wrapper.appendChild(img);
  wrapper.appendChild(btnHapus);

  const previewContainer = tipe === "ruangan" ? "flipbookRuanganPreview" : "flipbookMenuPreview";
  document.getElementById(previewContainer).appendChild(wrapper);
}

  
    // Tambah gambar flipbook
    function tambahGambar(tipe) {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";
      input.style.display = "none";
  
      input.onchange = async function (e) {
        const file = e.target.files[0];
        if (!file) return;
  
        try {
          const imageUrl = await resizeIfNeeded(file);
          renderImagePreview(tipe, imageUrl);
  
          if (tipe === "ruangan") {
            flipbookRuanganImages.push(imageUrl);
          } else {
            flipbookMenuImages.push(imageUrl);
          }
        } catch (err) {
          alert("âŒ Gagal memproses gambar.");
          console.error("Error resize:", err);
        }
      };
  
      document.body.appendChild(input);
      input.click();
      document.body.removeChild(input);
    }
  
    // Simpan semua data ke IndexedDB
  async function simpanData() {
  try {
    const namaRestoran = document.getElementById("namaRestoran").value;
    const restoAddress = document.getElementById("restoAddress").value.trim();
    const restoPhone = document.getElementById("restoPhone").value.trim();
    const logo = document.getElementById("previewLogo").src || "";
    const nomorWaInputs = document.querySelectorAll(".nomor-wa");
    const nomorWaAdmin = Array.from(nomorWaInputs).map((input) => input.value);

    const menuData = [
      ...ambilMenu("menuFoodContainer"),
      ...ambilMenu("menuSnackContainer"),
      ...ambilMenu("menuDrinkContainer"),
    ];

    const data = {
      namaRestoran,
      restoAddress,
      restoPhone,
      logo,
      nomorWaAdmin,
      menuPromo,
      flipbookRuanganImages,
      flipbookMenuImages,
      menu: menuData,
      rooms: ambilSemuaRoom()
    };

    await saveDataToDB(data);
    alert("âœ… Semua data berhasil disimpan!");
  } catch (error) {
    console.error("âŒ Gagal menyimpan data:", error);
    alert("âŒ Gagal menyimpan data. Lihat console (F12) untuk detail.");
  }
}

    // Load data saat halaman dibuka
async function loadData() {
  try {
    await initDB();
    const data = await loadDataFromDB();

    // Data umum restoran
    document.getElementById("namaRestoran").value = data.namaRestoran || "";
    document.getElementById("restoAddress").value = data.restoAddress || "";
    document.getElementById("restoPhone").value = data.restoPhone || "";
    if (data.logo) document.getElementById("previewLogo").src = data.logo;

    // Nomor WA Admin
    if (Array.isArray(data.nomorWaAdmin)) {
      const container = document.getElementById("nomorWaContainer");
      container.innerHTML = "";
      data.nomorWaAdmin.forEach(() => tambahNomorWa());
      const nomorInputs = document.querySelectorAll(".nomor-wa");
      data.nomorWaAdmin.forEach((no, i) => {
        if (nomorInputs[i]) nomorInputs[i].value = no;
      });
    }

    // Promo
    if (Array.isArray(data.menuPromo)) {
      menuPromo = data.menuPromo;
      renderPromoUI();
    }

    // Menu utama
    if (Array.isArray(data.menu)) {
      data.menu.forEach((m) => tambahMenu(m.kategori || "food", m.nama, m.harga));
    }

    // Room/Package
        if (Array.isArray(data.rooms)) {
      const grouped = {
        hotel: document.getElementById("roomHotelContainer"),
        meeting: document.getElementById("meetingRoomContainer"),
        package: document.getElementById("packageContainer"),
      };

      data.rooms.forEach((room) => {
        tambahRoom(room.kategori);

        const forms = grouped[room.kategori].querySelectorAll(".room-form");
        const lastForm = forms[forms.length - 1];
        if (!lastForm) return;

        lastForm.querySelector(".room-nama").value = room.nama;
        lastForm.querySelector(".room-deskripsi").value = room.deskripsi;
        lastForm.querySelector(".room-harga").value = room.harga;

        if (room.image) {
          const preview = lastForm.querySelector(".gambar-preview");
          const hapusBtn = lastForm.querySelector(".hapus-gambar");
          const uploadBtn = lastForm.querySelector(".room-image-upload");

          preview.src = room.image;
          preview.style.display = "block";
          hapusBtn.style.display = "flex";
          uploadBtn.setAttribute("data-image", room.image);
        }
      });
    }


    // Flipbook Ruangan
    flipbookRuanganImages = data.flipbookRuanganImages || [];
    flipbookRuanganImages.forEach((src) => renderImagePreview("ruangan", src));

    // Flipbook Menu
    flipbookMenuImages = data.flipbookMenuImages || [];
    flipbookMenuImages.forEach((src) => renderImagePreview("menu", src));

  } catch (err) {
    console.error("âŒ Gagal load data IndexedDB:", err);
  }
}
    // Reset semua data
    async function resetData() {
      if (!confirm("Yakin ingin menghapus semua data?")) return;
      try {
        await clearDataDB();
        location.reload();
      } catch (err) {
        alert("âŒ Gagal hapus data: " + err.message);
      }
    }
  
    // Backup data ke file JSON
    async function backupData() {
      try {
        const data = await loadDataFromDB();
        if (!data) {
          alert("Tidak ada data untuk di-backup!");
          return;
        }
  
        const filename = `menuva-backup-${Date.now()}.json`;
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
  
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
  
        const statusDiv = document.getElementById("backupDownloadLink");
        statusDiv.innerHTML = `
          âœ… Backup berhasil! File <strong>${filename}</strong> siap di-download.<br>
          <a href="${url}" download="${filename}" style="margin-top:10px;display:inline-block;padding:10px 16px;background:#007bff;color:white;text-decoration:none;border-radius:6px;">
            ğŸ“¥ Klik di sini jika download tidak dimulai otomatis
          </a>
        `;
      } catch (err) {
        alert("âŒ Gagal backup data: " + err.message);
      }
    }
  
    // Restore data dari file JSON
    function restoreDataFromFile(event) {
      const file = event.target.files[0];
      if (!file) return;
  
      const reader = new FileReader();
      reader.onload = async function (e) {
        try {
          const json = JSON.parse(e.target.result);
          await saveDataToDB(json);
          alert("âœ… Data berhasil direstore dari file!\nHalaman akan dimuat ulang...");
          location.reload();
        } catch (err) {
          alert("âŒ Gagal membaca file JSON. Pastikan file valid.");
          console.error("Restore error:", err);
        }
      };
      reader.readAsText(file);
    }
  
  window.addEventListener("DOMContentLoaded", async () => {
  await initDB();
  await loadData();
  tampilkanListRoom(); // ini kunci
});
  </script>
  
</body>
</html>

































