<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Admin Panel - Menuva</title>
  <style>
   * { box-sizing: border-box; }
       body {
      font-family: Arial, sans-serif;
      padding: 20px;
      padding-bottom: 90px;
      background-color: #f4f4f4;
      margin: 0;
    }
    .menuva-logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .menuva-logo img {
      height: 90px;
    }
    h1, h2,h3 {
      text-align: center;
      margin: 10px 0;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 1rem;
    }
    .menu-item {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    .menu-item input {
      flex: 1 1 40%;
    }
    .menu-item button {
      flex: 1 1 auto;
      white-space: nowrap;
      background: linear-gradient(135deg, #7f5af0, #2cb5e8);
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    .btn-success {
      background-color: #2ecc71;
      color: white;
    }
     .btn-plus {
      background-color: #87CEFA;
      color: white;
    }
    .btn-secondary {
      background-color: #3498db;
      color: white;
    }
    .preview img {
      max-width: 100px;
      margin: 5px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) {
      .menu-item input, .menu-item button {
        width: 100%;
      }
    }
    .btn-orange {
  background-color: orange;
  color: white;
  border: none;
}
.room-section > div:nth-child(2) button {
  padding: 6px 14px;
  border-radius: 6px;
  background-color: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
.room-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}
.room-form {
  padding: 10px;
  border: 1px dashed #ccc;
  margin-bottom: 12px;
  border-radius: 6px;
  background-color: #fff;
}
.room-form input[type="text"],
.room-form input[type="number"],
.room-form input[type="file"] {
  display: block;
  margin-bottom: 8px;
  width: 100%;
  padding: 6px;
  font-size: 14px;
}
.room-form .room-preview img {
  max-height: 80px;
  margin-top: 4px;
}

.gambar-preview-wrapper {
  position: relative;
  display: inline-block;
  margin-top: 10px;
}

.gambar-preview {
  height: auto !important;
  width: auto !important;
  max-height: 200px !important; /* Ubah sesuai keinginan */
  max-width: 100% !important;
  display: block;
}
.hapus-gambar {
  position: absolute;
  top: -8px;
  right: -8px;
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 14px;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  transition: background 0.2s;
}

.hapus-gambar:hover {
  background: #cc0000;
}
  .btn-hapus-gambar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: none;
  background: red;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: background 0.2s, transform 0.1s ease;
}

.btn-hapus-gambar:hover {
  background: #cc0000;
  transform: scale(1.05);
}

.section-box {
  border: none;
  padding: 16px;
  margin-bottom: 24px;
  border-radius: 8px;
  background: #fff;
}

.section-box h2,
.section-box h3 {
  margin-top: 0;
}

.room-section {
  margin-bottom: 20px;
}

.room-section button {
  margin-bottom: 10px;
  background-color: #CAE1FF;
}
.btn-simpan {
    background-color: #17a2b8;
    color: white;
    font-weight: bold;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
  }
    /* ğŸ”® Tombol Tambah - Ungu/Biru Neon */
.btn-tambah-room {
  background: linear-gradient(135deg, #7f5af0, #2cb5e8);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(127, 90, 240, 0.3);
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-tambah-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(44, 181, 232, 0.5);
}
.btn-hapus-room {
  background: linear-gradient(135deg, #ff6b6b, #fbc687);
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
  margin-top: 10px;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-hapus-room:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(251, 198, 135, 0.5);
}

/* ğŸ–¼ï¸ Upload Gambar - Sky Blue Gradient */
.btn-upload-gambar {
  background: linear-gradient(135deg, #00c6ff, #0072ff);
  color: white;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  margin-top: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.3s ease;
}
.btn-upload-gambar:hover {
  opacity: 0.85;
}

    /* Fixed button bar bawah layar */
    .fixed-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #ddd;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 10px 20px;
      z-index: 10000;
    }
    .fixed-bar button {
      flex: 1;
      padding: 10px 0;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: white;
    }
    .btn-order {
      background-color: #007bff;
    }
    .btn-order:hover {
      background-color: #0056b3;
    }
    .btn-room {
      background-color: #28a745;
    }
    .btn-room:hover {
      background-color: #1e7e34;
    }

    @media (max-width: 480px) {
      .fixed-bar {
        flex-direction: column;
        padding: 10px;
        gap: 8px;
      }
      .fixed-bar button {
        width: 100%;
        margin: 0;
      }
      .fixed-bar button:last-child {
        margin-bottom: 0;
      }
    }

    
  </style>
</head>
<body>

 <!-- Logo -->
<div class="menuva-logo">
  <img src="menuva-logo.png" alt="Logo Menuva">
</div>

<!-- Identitas Restoran -->
<div class="section">
  <h2>ğŸ“‡ Identitas Restoran</h2>
  <input type="file" id="logoInput" accept="image/*" onchange="handleImageUpload(event,'previewLogo')"/>
  <img id="previewLogo" src="" alt="Logo Restoran"/>
  <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
  <input type="text" id="restoAddress" placeholder="Alamat Restoran" />
  <input type="text" id="restoPhone" placeholder="No. Telepon" />
</div>

<!-- Menu Promo -->
<div class="section">
  <h2>ğŸ”¥ Menu Promo</h2>
  <input type="text" id="promoNama" placeholder="Nama Promo">
  <input type="text" id="promoHarga" placeholder="Harga Promo">
  <input type="text" id="promoDesc" placeholder="Deskripsi Promo">
  <div id="promoContainer"></div>
  <button class="btn-orange" 
    onclick="tambahPromo(
      document.getElementById('promoNama').value,
      document.getElementById('promoHarga').value,
      document.getElementById('promoDesc').value
    )">+ Tambah Menu Promo</button>
</div>

<!-- Food Menu -->
<div class="section">
  <h2>ğŸ“‹ FOOD MENU</h2>
  <input type="text" id="menuFoodNama" placeholder="Nama Menu Food">
  <input type="text" id="menuFoodHarga" placeholder="Harga Menu Food">
  <div id="menuFoodContainer"></div>
  <button class="btn-success" onclick="tambahMenu('food', document.getElementById('menuFoodNama').value, document.getElementById('menuFoodHarga').value)">+ Tambah Menu</button>
</div>

<!-- Snack Menu -->
<div class="section">
  <h2>ğŸ“‹ SNACK & DESSERT</h2>
  <input type="text" id="menuSnackNama" placeholder="Nama Menu Snack">
  <input type="text" id="menuSnackHarga" placeholder="Harga Menu Snack">
  <div id="menuSnackContainer"></div>
  <button class="btn-success" onclick="tambahMenu('snack', document.getElementById('menuSnackNama').value, document.getElementById('menuSnackHarga').value)">+ Tambah Menu</button>
</div>

<!-- Drink Menu -->
<div class="section">
  <h2>ğŸ“‹ DRINK</h2>
  <input type="text" id="menuDrinkNama" placeholder="Nama Menu Drink">
  <input type="text" id="menuDrinkHarga" placeholder="Harga Menu Drink">
  <div id="menuDrinkContainer"></div>
  <button class="btn-success" onclick="tambahMenu('drink', document.getElementById('menuDrinkNama').value, document.getElementById('menuDrinkHarga').value)">+ Tambah Menu</button>
</div>

<!-- Nomor WhatsApp Admin -->
<div class="section">
  <h3>ğŸ“± Nomor WhatsApp Admin</h3>
  <input type="text" id="inputNomorWa" placeholder="Contoh: 6281234567890">
  <div id="nomorWaContainer"></div>
  <button class="btn-plus" onclick="tambahNomorWa(document.getElementById('inputNomorWa').value)">+ Tambah Nomor WA</button>
</div>

<!-- Galeri Ruangan -->
<div class="section">
  <h2>ğŸ“¸ Galeri Ruangan</h2>
  <button class="btn-plus" onclick="document.getElementById('flipbookRuanganUpload').click()">+ Tambah Gambar Ruangan</button>
  <input type="file" id="flipbookRuanganUpload" accept="image/*" multiple onchange="tambahGambar('ruangan', this.files)" style="display:none;">
  <div id="flipbookRuanganPreview"></div>
</div>

<!-- Galeri Menu -->
<div class="section">
  <h2>ğŸ“– Menu Restoran</h2>
  <button class="btn-plus" onclick="document.getElementById('flipbookMenuUpload').click()">+ Tambah Gambar Menu</button>
  <input type="file" id="flipbookMenuUpload" accept="image/*" multiple onchange="tambahGambar('menu', this.files)" style="display:none;">
  <div id="flipbookMenuPreview"></div>
</div>

<!-- Room / Package -->
<div class="section">
  <h2>ğŸ¨ Room / Package</h2>
  <!-- Hotel -->
  <input type="text" id="roomHotelNama" placeholder="Nama Room Hotel">
  <input type="text" id="roomHotelKapasitas" placeholder="Kapasitas">
  <div id="roomHotelContainer"></div>
  <button class="btn-plus" onclick="tambahRoom('hotel', document.getElementById('roomHotelNama').value, document.getElementById('roomHotelKapasitas').value)">+ Tambah Room Hotel</button>
  <!-- Meeting -->
  <input type="text" id="roomMeetingNama" placeholder="Nama Meeting Room">
  <input type="text" id="roomMeetingKapasitas" placeholder="Kapasitas">
  <div id="meetingRoomContainer"></div>
  <button class="btn-plus" onclick="tambahRoom('meeting', document.getElementById('roomMeetingNama').value, document.getElementById('roomMeetingKapasitas').value)">+ Tambah Meeting Room</button>
  <!-- Package -->
  <input type="text" id="packageNama" placeholder="Nama Package">
  <input type="text" id="packageKapasitas" placeholder="Kapasitas / Jumlah">
  <div id="packageContainer"></div>
  <button class="btn-plus" onclick="tambahRoom('package', document.getElementById('packageNama').value, document.getElementById('packageKapasitas').value)">+ Tambah Package</button>
</div>

<hr>

<!-- Tombol Simpan & Lihat -->
<div class="section">
  <button class="btn-success" onclick="simpanSemua()">ğŸ’¾ Simpan Semua</button>
  <button onclick="window.open('menu.html')" class="btn-orange" style="margin-top: 10px;">ğŸ‘ï¸ Lihat Halaman Customer</button>
  <button id="btnSalinLink" onclick="salinLinkMenu()" style="display:none; background-color: rgb(58,82,219); color:white; padding:10px; border:none; border-radius:8px; margin-top:10px;">ğŸ“‹ Copy Link Untuk Dibagikan</button>
</div>

<!-- Backup & Restore -->
<div class="section">
  <h2>ğŸ” Backup & Restore Data</h2>
  <button onclick="backupData()">ğŸ“¦ Backup Data</button>
  <div id="backupDownloadLink"></div>
  <label for="restoreInput" style="margin-top: 10px; display:block;">ğŸ“‚ Pilih File JSON untuk Restore:</label>
  <input type="file" id="restoreInput" accept=".json" onchange="restoreDataFromFile(event)">
</div>


  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

<script type="text/javascript">
/* =========================
   Firebase Init
========================= */
const firebaseConfig = {
  apiKey: "AIzaSyBxKnIO_cIX8B94608zdx5uGs_o4M7ctEk",
  authDomain: "menuvaresto.firebaseapp.com",
  projectId: "menuvaresto",
  storageBucket: "menuvaresto.appspot.com",
  messagingSenderId: "576149783998",
  appId: "1:576149783998:web:7ace26d67b02d45226e5ef"
};
const app = firebase.initializeApp(firebaseConfig);
const firestore = firebase.firestore(app);

/* =========================
   IndexedDB Helpers
========================= */
const DB_NAME = "menuvaDB";
const STORE   = "menuvaData";
const FIX_ID  = "menuvaData";

function openDB() {
  return new Promise((resolve,reject)=>{
    const req = indexedDB.open(DB_NAME,1);
    req.onupgradeneeded = (e)=>{
      const db = e.target.result;
      if(!db.objectStoreNames.contains(STORE)) db.createObjectStore(STORE,{keyPath:"id"});
    };
    req.onsuccess = (e)=>resolve(e.target.result);
    req.onerror = ()=>reject(req.error);
  });
}

async function saveDataToDB(data){
  if(!data.id) data.id=FIX_ID;
  const db = await openDB();
  return new Promise((resolve,reject)=>{
    const tx = db.transaction(STORE,"readwrite");
    const store = tx.objectStore(STORE);
    const clearReq = store.clear();
    clearReq.onsuccess = ()=>{
      const putReq = store.put(data);
      putReq.onsuccess = ()=>{db.close();resolve(true)};
      putReq.onerror   = ()=>{db.close();reject(putReq.error)};
    };
    clearReq.onerror = ()=>{db.close();reject(clearReq.error)};
  });
}

async function loadDataFromDB(){
  const db = await openDB();
  return new Promise((resolve,reject)=>{
    const tx = db.transaction(STORE,"readonly");
    const store = tx.objectStore(STORE);
    const getReq = store.get(FIX_ID);
    getReq.onsuccess = ()=>{db.close();resolve(getReq.result||null)};
    getReq.onerror   = ()=>{db.close();reject(getReq.error)};
  });
}

/* =========================
   Firestore Save
========================= */
async function saveToFirestore(data){
  try{
    await firestore.collection("menuva").doc("data").set(data);
    console.log("Data tersimpan di Firestore âœ…");
  }catch(err){console.error("Gagal simpan Firestore",err);}
}

/* =========================
   Backup & Restore
========================= */
async function backupData(){
  try{
    const data = await loadDataFromDB();
    if(!data){alert("Tidak ada data untuk backup!");return;}
    const filename = `menuva-backup-${Date.now()}.json`;
    const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url;a.download=filename;document.body.appendChild(a);a.click();a.remove();
    const statusDiv = document.getElementById("backupDownloadLink");
    if(statusDiv) statusDiv.innerHTML=`âœ… Backup berhasil! File <strong>${filename}</strong> siap di-download.`;
  }catch(err){alert("âŒ Gagal backup: "+err.message);}
}

function restoreDataFromFile(event){
  const file=event?.target?.files?.[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = async (e)=>{
    try{
      const json = JSON.parse(e.target.result);
      if(!json.id) json.id=FIX_ID;
      await saveDataToDB(json);
      alert("âœ… Restore sukses, reload halaman...");
      location.reload();
    }catch(err){console.error("Restore error:",err);alert("âŒ File JSON invalid!");}
  };
  reader.readAsText(file);
}

/* =========================
   Upload â†’ Preview
========================= */
function handleImageUpload(e,previewId){
  const file = e?.target?.files?.[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{ const img = document.getElementById(previewId); if(img) img.src=reader.result; };
  reader.readAsDataURL(file);
}

/* =========================
   Fungsi Admin Lengkap
========================= */
window.menuPromo=[];
window.flipbookRuanganImages=[];
window.flipbookMenuImages=[];
window.nomorWAList=[];
window.roomsList=[];

window.tambahPromo = function(nama,harga,deskripsi){
  if(!nama) return alert("Nama promo kosong!");
  window.menuPromo.push({nama,harga,deskripsi});
  renderPromoUI();
}

window.tambahMenu = function(kategori,nama,harga){
  if(!kategori || !nama) return alert("Kategori atau nama kosong!");
  const container=document.getElementById(kategori+"Container");
  if(container){
    const div=document.createElement("div");
    div.innerText=`${nama} - ${harga}`;
    container.appendChild(div);
  }
}

window.tambahGambar = function(url,type){
  if(type==="ruangan") window.flipbookRuanganImages.push(url);
  if(type==="menu") window.flipbookMenuImages.push(url);
  renderImagePreview(type,url);
}

window.renderPromoUI = function(){
  const promoContainer = document.getElementById("promoContainer");
  if(!promoContainer) return;
  promoContainer.innerHTML="";
  window.menuPromo.forEach(p=>{
    const div=document.createElement("div");
    div.innerText=`${p.nama} - ${p.harga} - ${p.deskripsi}`;
    promoContainer.appendChild(div);
  });
}

window.renderImagePreview = function(type,url){
  const container=document.getElementById(type+"PreviewContainer");
  if(!container) return;
  const img=document.createElement("img");
  img.src=url;
  img.style.width="80px";
  img.style.height="80px";
  img.style.margin="4px";
  container.appendChild(img);
}

window.tambahNomorWa = function(nomor){
  if(!nomor) return alert("Nomor WA kosong!");
  window.nomorWAList.push(nomor);
  const container=document.getElementById("nomorWAContainer");
  if(container){
    const div=document.createElement("div");
    div.innerText=nomor;
    container.appendChild(div);
  }
}

window.tambahRoom = function(nama){
  if(!nama) return alert("Nama room kosong!");
  window.roomsList.push(nama);
  const container=document.getElementById("roomContainer");
  if(container){
    const div=document.createElement("div");
    div.innerText=nama;
    container.appendChild(div);
  }
}

/* =========================
   Simpan Semua Data
========================= */
async function simpanSemua(){
  const identitas={
    namaRestoran:document.getElementById("restoName")?.value||"",
    nomorWA:document.getElementById("restoWA")?.value||"",
    logo:document.getElementById("logoPreview")?.src||""
  };
  const data={
    id:FIX_ID,
    identitas,
    menu:[], // bisa diisi ambilMenu()
    promo:window.menuPromo,
    rooms:window.roomsList,
    flipbookRuangan:window.flipbookRuanganImages,
    flipbookMenu:window.flipbookMenuImages
  };
  try{
    await saveDataToDB(data);
    await saveToFirestore(data);
    alert("âœ… Data tersimpan!");
  }catch(err){console.error(err);alert("âŒ Gagal simpan!");}
}

/* =========================
   Load Semua Data
========================= */
async function loadSemuaData(){
  try{
    const data=await loadDataFromDB();
    if(!data) return;
    document.getElementById("restoName").value=data.identitas?.namaRestoran||"";
    document.getElementById("restoWA").value=data.identitas?.nomorWA||"";
    if(data.identitas?.logo) document.getElementById("logoPreview").src=data.identitas.logo;

    window.menuPromo=data.promo||[];
    renderPromoUI();

    window.roomsList=data.rooms||[];
    const roomContainer=document.getElementById("roomContainer");
    if(roomContainer) roomContainer.innerHTML="",window.roomsList.forEach(r=>{
      const div=document.createElement("div"); div.innerText=r; roomContainer.appendChild(div);
    });

    window.flipbookRuanganImages=data.flipbookRuangan||[];
    window.flipbookMenuImages=data.flipbookMenu||[];
    renderImagePreview("ruangan",window.flipbookRuanganImages);
    renderImagePreview("menu",window.flipbookMenuImages);

    console.log("Data berhasil dimuat âœ…");
  }catch(err){console.error("Gagal load data",err);}
}

/* =========================
   Auto Init + Expose Global
========================= */
window.backupData=backupData;
window.restoreDataFromFile=restoreDataFromFile;
window.handleImageUpload=handleImageUpload;
window.simpanSemua=simpanSemua;

document.addEventListener("DOMContentLoaded",()=>{loadSemuaData();});
window.addEventListener("error",(e)=>{console.error("Global error:",e?.error||e?.message);});
</script>

  <div class="fixed-bar">
  <button onclick="window.location.href='index.html'" class="btn-success">ğŸ”’ Logout</button>
  <button onclick="resetData()" class="btn-danger">ğŸ—‘ï¸ Reset Semua Data</button>
  </div>
  
</body>
</html>

























































































