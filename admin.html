<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Panel - Menuva</title>
<style>
/* ==== CSS Tetap Sama ==== */
* { box-sizing: border-box; }
body { font-family: Arial, sans-serif; padding: 20px; background:#f4f4f4; margin:0; overflow-x:hidden; }
.menuva-logo { text-align:center; margin-bottom:10px; }
.menuva-logo img { height:90px; }
h1,h2,h3 { text-align:center; margin:10px 0; }
.section { background:#fff; padding:20px; margin-bottom:20px; border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,0.1); }
input,button,textarea { padding:10px; margin:5px 0; border-radius:5px; border:1px solid #ccc; width:100%; font-size:1rem; }
.menu-item { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom:10px; }
.menu-item input { flex:1 1 40%; }
.menu-item button { flex:1 1 auto; white-space:nowrap; background:linear-gradient(135deg, #7f5af0, #2cb5e8); }
.btn-danger{background:#e74c3c;color:#fff;} .btn-success{background:#2ecc71;color:#fff;} .btn-secondary{background:#3498db;color:#fff;}
.preview img { max-width:100px; margin:5px; border-radius:5px; box-shadow:0 1px 4px rgba(0,0,0,0.1);}
@media (max-width:600px){.menu-item input,.menu-item button{width:100%;}}
.btn-orange{background:orange;color:white;border:none;}
.room-section>div:nth-child(2) button{padding:6px 14px;border-radius:6px;background-color:#007bff;color:white;border:none;cursor:pointer;}
.room-section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.room-form{padding:10px;border:1px dashed #ccc;margin-bottom:12px;border-radius:6px;background-color:#fff;}
.room-form input[type=text], .room-form input[type=number], .room-form input[type=file], .room-form textarea { display:block; margin-bottom:8px; width:100%; padding:6px; font-size:14px;}
.room-form .room-preview img{max-height:80px;margin-top:4px;}
.gambar-preview-wrapper{position:relative; display:inline-block; margin-top:10px;}
.gambar-preview{height:auto!important;width:auto!important; max-height:200px!important; max-width:100%!important; display:block;}
.hapus-gambar{position:absolute; top:-8px; right:-8px; background:red; color:white; border:none; border-radius:50%; font-size:14px; width:24px; height:24px; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 6px rgba(0,0,0,0.2);}
.hapus-gambar:hover{background:#cc0000;}
.btn-hapus-gambar{width:24px;height:24px;border-radius:50%;border:none;background:red;color:white;display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0;font-size:14px;box-shadow:0 2px 6px rgba(0,0,0,0.2);transition:background 0.2s, transform 0.1s ease;}
.btn-hapus-gambar:hover{background:#cc0000; transform:scale(1.05);}
.section-box{border:none;padding:16px;margin-bottom:24px;border-radius:8px;background:#fff;}
.section-box h2,h3{margin-top:0;}
.room-section{margin-bottom:20px;}
.room-section button{margin-bottom:10px;background-color:#17a2b8;}
.btn-simpan{background-color:#17a2b8;color:white;font-weight:bold;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;}
.btn-tambah-room{background:linear-gradient(135deg,#7f5af0,#2cb5e8);color:#fff;padding:8px 14px;border:none;border-radius:8px;font-weight:bold;box-shadow:0 4px 10px rgba(127,90,240,0.3);cursor:pointer;transition:transform 0.2s ease;}
.btn-tambah-room:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(44,181,232,0.5);}
.btn-hapus-room{background:linear-gradient(135deg,#ff6b6b,#fbc687);color:#fff;padding:8px 14px;border:none;border-radius:8px;font-weight:bold;box-shadow:0 4px 10px rgba(255,107,107,0.3);margin-top:10px;cursor:pointer;transition:transform 0.2s ease;}
.btn-hapus-room:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(251,198,135,0.5);}
.btn-upload-gambar{background:linear-gradient(135deg,#00c6ff,#0072ff);color:white;padding:6px 12px;border:none;border-radius:6px;margin-top:6px;font-weight:500;cursor:pointer;transition:opacity 0.3s ease;}
.btn-upload-gambar:hover{opacity:0.85;}
.fixed-bar{position:fixed!important;bottom:0;left:0;width:100vw;background:#fff;border-top:1px solid #ddd;box-shadow:0 -2px 6px rgba(0,0,0,0.1);display:flex;justify-content:center;gap:15px;padding:10px 20px;z-index:9999;}
.fixed-bar button{flex:1;padding:12px;font-size:16px;font-weight:bold;border-radius:8px;border:none;cursor:pointer;transition:background-color 0.3s ease;color:white;}
.btn-order{background-color:#007bff;}
.btn-order:hover{background-color:#0056b3;}
.btn-room{background-color:#e74c3c;}
.btn-room:hover{background-color:#c0392b;}
  /* ===== Tambahan untuk space bawah agar scroll tidak tertutup fixed bar ===== */
body {
  padding-bottom: 80px; /* sesuaikan tinggi fixed-bar, default 80px */
}
  .fixed-bar {
  padding: 6px 10px; /* lebih tipis dari 10px 20px */
  gap: 8px;          /* jarak antar tombol lebih rapat */
}

.fixed-bar button {
  flex: 0 1 auto;    /* jangan paksa tombol memenuhi seluruh bar */
  min-width: 100px;  /* ukuran minimum tombol */
  padding: 8px 12px; /* lebih kecil dari 12px */
  font-size: 14px;   /* lebih kecil dari 16px */
  border-radius: 6px;/* radius tombol lebih kecil */
}

</style>
</head>
<body>

<div class="menuva-logo">
  <img src="menuva-logo.png" alt="Logo Menuva">
</div>

<!-- Identitas Restoran -->
<div class="section">
  <h2>ğŸ“‡ Identitas Restoran</h2>
  <input type="file" id="logoInput" accept="image/*" onchange="handleImageUpload(this, 'previewLogo')" />
  <img id="previewLogo" src="" alt="Logo Restoran" style="max-height: 80px; margin-top:10px;" />
  
  <input type="text" id="namaRestoran" placeholder="Nama Restoran" />
  <label>Alamat Restoran</label>
  <input id="restoAddress" type="text" placeholder="Jl. Sudirman No. 10, Jakarta" />
  <label>No. Telepon</label>
  <input id="restoPhone" type="text" placeholder="08xx-xxxx-xxxx" />
</div>

<!-- Menu Promo -->
<div class="section">
  <h2>ğŸ”¥ Menu Promo</h2>
  <div id="promoContainer"></div>
  <button class="btn-orange" onclick="tambahPromo()">+ Tambah Menu Promo</button>
</div>

<!-- Menu Food -->
<div class="section">
  <h2>ğŸ“‹ FOOD MENU</h2>
  <div id="menuFoodContainer"></div>
  <button class="btn-success" onclick="tambahMenu('food')">+ Tambah Menu</button>
</div>

<div class="section">
  <h2>ğŸ“‹ SNACK & DESSERT</h2>
  <div id="menuSnackContainer"></div>
  <button class="btn-success" onclick="tambahMenu('snack')">+ Tambah Menu</button>
</div>

<div class="section">
  <h2>ğŸ“‹ DRINK</h2>
  <div id="menuDrinkContainer"></div>
  <button class="btn-success" onclick="tambahMenu('drink')">+ Tambah Menu</button>
</div>

<!-- Nomor WA -->
<div class="section-box" id="waContainerBox">
  <h3>ğŸ“± Nomor WhatsApp Admin</h3>
  <div id="nomorWaContainer">
    <input type="text" class="nomor-wa" placeholder="Contoh: 6281234567890">
  </div>
  <button onclick="tambahNomorWa()">+ Tambah Nomor WA</button>
</div>

<!-- Galeri Ruangan -->
<div class="section">
  <h2>ğŸ“¸ Galeri Ruangan</h2>
  <button onclick="tambahGambar('ruangan')">+ Tambah Gambar Ruangan</button>
  <input type="file" id="flipbookRuanganUpload" accept="image/*" multiple style="display:none;" onchange="handleMultipleUpload(this, 'flipbookRuanganPreview')" />
  <div id="flipbookRuanganPreview"></div>
</div>

<!-- Flipbook Menu -->
<div class="section">
  <h2>ğŸ“– Menu Restoran</h2>
  <button onclick="tambahGambar('menu')">+ Tambah Gambar Menu</button>
  <input type="file" id="flipbookMenuUpload" accept="image/*" multiple style="display:none;" onchange="handleMultipleUpload(this, 'flipbookMenuPreview')" />
  <div id="flipbookMenuPreview"></div>
</div>

<!-- Room / Package -->
<div class="section-box" id="roomContainerBox">
  <h2>ğŸ¨ Room / Package</h2>

  <div class="room-section">
    <h3>ğŸ›ï¸ Room Hotel</h3>
    <button onclick="tambahRoom('hotel')">+ Tambah Room Hotel</button>
    <div id="roomHotelContainer"></div>
  </div>

  <div class="room-section">
    <h3>ğŸ’¼ Meeting Room</h3>
    <button onclick="tambahRoom('meeting')">+ Tambah Meeting Room</button>
    <div id="meetingRoomContainer"></div>
  </div>

  <div class="room-section">
    <h3>ğŸ Package</h3>
    <button onclick="tambahRoom('package')">+ Tambah Package</button>
    <div id="packageContainer"></div>
  </div>
</div>

<hr>
<div class="section">
  <button class="btn-simpan" onclick="simpanData()">ğŸ’¾ Simpan Semua</button>
  <button class="btn-orange" onclick="window.location.href='menu.html'">ğŸ›’ Halaman Customer</button>
  <button class="btn-secondary" onclick="backupData()">ğŸ“¦ Backup Data</button>
  <input type="file" accept=".json" onchange="restoreDataFromFile(event)" />
  <div id="backupDownloadLink"></div>
</div>

<div style="background: #fef9e7; padding: 10px; border-left: 5px solid #f1c40f; margin-top: 10px; font-size: 14px;">
  <strong>Panduan Penggunaan:</strong><br>
  PENTING!!<br>
  ğŸ”¹ Klik <strong>â¬‡ï¸ Backup Data</strong> untuk menyimpan semua data restoran ke file berformat <strong>.json</strong>.<br>
  ğŸ”¹ Simpan file tersebut dengan baik dan aman di perangkat Anda.<br>
  ğŸ”¹ Klik <strong>ğŸ“‚ Pilih File</strong> untuk me-restore data dari file <strong>.json</strong> hasil backup.<br>
  âš ï¸ Proses restore akan menggantikan seluruh data yang ada saat ini dan tidak bisa dibatalkan.<br>
  ğŸ’¡ Gunakan fitur ini sebelum mengganti perangkat atau membersihkan data browser.
</div>

  <script>
/* ==== IndexedDB ==== */
let db;
async function initDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open("menuvaDB", 1);
    request.onerror = (e) => reject(e);
    request.onsuccess = (e) => {
      db = e.target.result;
      resolve();
    };
    request.onupgradeneeded = (e) => {
      db = e.target.result;
      if (!db.objectStoreNames.contains("menuvaData")) {
        db.createObjectStore("menuvaData", { keyPath: "id" });
      }
    };
  });
}

async function saveDataToDB(data) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction("menuvaData", "readwrite");
    const store = tx.objectStore("menuvaData");
    store.put({ id: "main", ...data });
    tx.oncomplete = () => resolve();
    tx.onerror = (e) => reject(e);
  });
}

async function loadDataFromDB() {
  return new Promise((resolve, reject) => {
    const tx = db.transaction("menuvaData", "readonly");
    const store = tx.objectStore("menuvaData");
    const req = store.get("main");
    req.onsuccess = (e) => resolve(e.target.result || {});
    req.onerror = (e) => reject(e);
  });
}

async function clearDataDB() {
  return new Promise((resolve, reject) => {
    const tx = db.transaction("menuvaData", "readwrite");
    const store = tx.objectStore("menuvaData");
    const req = store.clear();
    req.onsuccess = () => resolve();
    req.onerror = (e) => reject(e);
  });
}

/* ==== Global Vars ==== */
let flipbookRuanganImages = [];
let flipbookMenuImages = [];
let menuPromo = [];

/* ==== Resize & Upload Gambar ==== */
async function resizeIfNeeded(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        const scale = Math.min(1280 / img.width, 1);
        const canvas = document.createElement("canvas");
        canvas.width = img.width * scale;
        canvas.height = img.height * scale;
        canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);
        resolve(canvas.toDataURL("image/jpeg", 0.9));
      };
      img.src = e.target.result;
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

/* ==== Simpan Data ==== */
async function simpanData() {
  try {
    const data = {
      namaRestoran: document.getElementById("namaRestoran").value,
      restoAddress: document.getElementById("restoAddress").value,
      restoPhone: document.getElementById("restoPhone").value,
      logo: document.getElementById("previewLogo").src || "",
      nomorWaAdmin: Array.from(document.querySelectorAll(".nomor-wa")).map(i => i.value),
      menuPromo: getAllPromo(),
      menu: [
        ...ambilMenu("menuFoodContainer"),
        ...ambilMenu("menuSnackContainer"),
        ...ambilMenu("menuDrinkContainer")
      ],
      rooms: ambilSemuaRoom(),
      flipbookRuanganImages,
      flipbookMenuImages
    };

    await saveDataToDB(data);
    alert("âœ… Semua data berhasil disimpan!");
  } catch (err) {
    console.error(err);
    alert("âŒ Gagal simpan data");
  }
}

/* ==== Load Data ==== */
async function loadData() {
  try {
    await initDB();
    const data = await loadDataFromDB();

    document.getElementById("namaRestoran").value = data.namaRestoran || "";
    document.getElementById("restoAddress").value = data.restoAddress || "";
    document.getElementById("restoPhone").value = data.restoPhone || "";
    if (data.logo) document.getElementById("previewLogo").src = data.logo;

    if (Array.isArray(data.nomorWaAdmin)) {
      document.getElementById("nomorWaContainer").innerHTML = "";
      data.nomorWaAdmin.forEach(() => tambahNomorWa());
      document.querySelectorAll(".nomor-wa").forEach((input, i) => {
        input.value = data.nomorWaAdmin[i];
      });
    }

    if (Array.isArray(data.menuPromo)) {
      document.getElementById("promoContainer").innerHTML = "";
      renderPromoFromData(data.menuPromo);
    }

    if (Array.isArray(data.menu)) {
      data.menu.forEach(m => tambahMenu(m.kategori, m.nama, m.harga));
    }

    if (Array.isArray(data.rooms)) {
      const grouped = {
        hotel: document.getElementById("roomHotelContainer"),
        meeting: document.getElementById("meetingRoomContainer"),
        package: document.getElementById("packageContainer")
      };
      data.rooms.forEach(r => {
        tambahRoom(r.kategori);
        const forms = grouped[r.kategori].querySelectorAll(".room-form");
        const lastForm = forms[forms.length - 1];
        lastForm.querySelector(".room-nama").value = r.nama;
        lastForm.querySelector(".room-deskripsi").value = r.deskripsi;
        lastForm.querySelector(".room-harga").value = r.harga;
        if (r.image) {
          const preview = lastForm.querySelector(".gambar-preview");
          const hapusBtn = lastForm.querySelector(".hapus-gambar");
          const uploadBtn = lastForm.querySelector(".room-image-upload");
          preview.src = r.image;
          preview.style.display = "block";
          hapusBtn.style.display = "flex";
          uploadBtn.setAttribute("data-image", r.image);
        }
      });
    }

    flipbookRuanganImages = data.flipbookRuanganImages || [];
    flipbookRuanganImages.forEach(s => renderImagePreview("ruangan", s));

    flipbookMenuImages = data.flipbookMenuImages || [];
    flipbookMenuImages.forEach(s => renderImagePreview("menu", s));

  } catch (err) {
    console.error(err);
    alert("âŒ Gagal load data");
  }
}

/* ==== Backup / Restore ke GitHub Gist ==== */
async function backupData() {
  try {
    const data = await loadDataFromDB();
    if (!data) { alert("Tidak ada data untuk di-backup!"); return; }

    const res = await fetch('http://localhost:3000/backup', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    const result = await res.json();
    alert("âœ… Backup berhasil! URL Gist: " + result.html_url);
  } catch (err) {
    console.error(err);
    alert("âŒ Gagal backup: " + err.message);
  }
}

async function restoreData(gistId) {
  try {
    const res = await fetch(`http://localhost:3000/restore/${gistId}`);
    const data = await res.json();
    await saveDataToDB(data);
    alert("âœ… Restore berhasil!");
    location.reload();
  } catch (err) {
    console.error(err);
    alert("âŒ Gagal restore: " + err.message);
  }
}

/* ==== Auto Load ==== */
window.addEventListener("DOMContentLoaded", async () => {
  await initDB();
  await loadData();
});
</script>


 <div class="fixed-bar">
  <button onclick="window.location.href='index.html'" class="btn-success">ğŸ”’ Logout</button>
  <button onclick="resetData()" class="btn-danger">ğŸ—‘ï¸ Reset Semua Data</button>
  </div>

</body>
</html>







