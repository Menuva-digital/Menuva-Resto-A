<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Order Makanan - Menuva</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fefefe;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ccc;
      padding: 10px 0;
    }
    .menu-name {
      font-weight: bold;
    }
    .qty-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .qty-controls button {
      padding: 5px 10px;
      font-size: 16px;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    label {
      font-weight: bold;
    }
    .summary {
      margin-top: 30px;
    }
    .summary p {
      font-size: 18px;
      margin: 10px 0;
    }
    .submit-btn {
      margin-top: 20px;
      padding: 12px 20px;
      font-size: 16px;
      background: orange;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 6px;
    }
    .logo-container {
      text-align: center;
      margin-bottom: 10px;
    }
    .logo-container img {
      max-width: 100px;
      max-height: 100px;
    }
  /* Container promo */
#promo-list {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  padding: 10px;
}

/* Kartu promo */
.promo-card {
  width: 100%;
  max-width: 320px;
  border: 1px solid #ddd;
  border-radius: 12px;
  overflow: hidden;
  background-color: #fff;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  text-align: center;
}

/* Gambar */
.promo-card img {
  width: 100%;
  height: auto;
  object-fit: cover;
  display: block;
}

/* Konten dalam kartu */
.promo-content {
  padding: 10px;
}

.promo-title {
  font-weight: bold;
  font-size: 18px;
  margin-bottom: 5px;
}

.promo-desc {
  font-size: 14px;
  color: #555;
  margin-bottom: 5px;
}

.promo-price {
  font-size: 16px;
  color: #009688;
  font-weight: bold;
  margin-bottom: 10px;
}

/* Qty */
.promo-qty {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}

.promo-qty button {
  width: 30px;
  height: 30px;
  border: none;
  background-color: #009688;
  color: #fff;
  font-size: 18px;
  border-radius: 4px;
  cursor: pointer;
}

.promo-qty span {
  min-width: 24px;
  text-align: center;
  font-size: 16px;
}

  </style>
</head>
<body>
  <div class="logo-container" id="logoContainer"></div>
  <h1 id="namaRestoranDisplay" style="font-size: 24px; font-weight: bold; margin-top: 10px; align-items: center;"></h1>

  <h1>üìù Pesan Menu</h1>

  <div id="promo-list" class="promo-container"></div>

  <label for="kategoriFilter">Filter Kategori Menu:</label>
  <select id="kategoriFilter" onchange="tampilkanMenu()">
    <option value="Semua">Semua Kategori</option>
  </select>

  <div id="menu-list"></div>

  <div class="summary">
    <p>Total Item: <span id="total-item">0</span></p>
    <p>Total Harga: Rp<span id="total-harga">0</span></p>

    <label for="nama">Nama Pemesan</label>
    <input type="text" id="nama" placeholder="Contoh: Budi">

    <label for="alamat">Alamat Pengantaran</label>
    <textarea id="alamat" placeholder="Contoh: Jl. Kenanga No. 123"></textarea>

    <label for="waktuAntar">Waktu Pengantaran (opsional)</label>
    <input type="datetime-local" id="waktuAntar" />

    <label for="catatan">Catatan Tambahan</label>
    <textarea id="catatan" placeholder="Contoh: Daging jangan terlalu matang"></textarea>

    <label for="ruangan">Catatan Pemakaian Ruangan</label>
    <input type="text" id="ruangan" placeholder="Contoh: Superior Room">

    <button class="submit-btn" onclick="kirimPesanan()">Kirim Pesanan</button>
  </div>

  <script>
  let data = null;
const pesanan = {};

function openDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open("MenuvaDB", 1);
    request.onerror = () => reject("‚ùå Gagal membuka database");
    request.onsuccess = (event) => resolve(event.target.result);
    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      if (!db.objectStoreNames.contains("menuvaData")) {
        db.createObjectStore("menuvaData", { keyPath: "id" });
      }
    };
  });
}

function getMainData() {
  return new Promise(async (resolve, reject) => {
    try {
      const db = await openDB();
      const tx = db.transaction("menuvaData", "readonly");
      const store = tx.objectStore("menuvaData");
      const getRequest = store.get(1);

      getRequest.onsuccess = () => {
        if (getRequest.result) resolve(getRequest.result);
        else reject("‚ö†Ô∏è Data tidak ditemukan");
      };
      getRequest.onerror = () => reject("‚ùå Gagal membaca data dari store");
    } catch (e) {
      reject(e);
    }
  });
}

document.addEventListener("DOMContentLoaded", async () => {
  try {
    data = await getMainData();

    const menuList = document.getElementById("menu-list");
    const totalItem = document.getElementById("total-item");
    const totalHarga = document.getElementById("total-harga");
    const kategoriFilter = document.getElementById("kategoriFilter");
    const logoContainer = document.getElementById("logoContainer");

    console.log("üî• Promo data yang diterima:", data.menuPromo)

    if (data && data.menu && data.menu.length) {
     
      // Isi filter kategori
      const kategoriUnik = [...new Set(data.menu.map(m => m.kategori).filter(k => k && k.trim() !== ""))];
      kategoriUnik.forEach(k => {
        const opt = document.createElement("option");
        opt.value = k;
        opt.textContent = k;
        kategoriFilter.appendChild(opt);
      });

      // Tampilkan menu pertama kali
      tampilkanMenu();
    } else {
      menuList.innerHTML = "<p>‚ö†Ô∏è Tidak ada menu tersedia</p>";
    }
    tampilkanIdentitasRestoran(data);

  } catch (err) {
    console.error("‚ùå Gagal ambil data dari IndexedDB:", err);
    document.getElementById("menu-list").innerHTML = "<p>‚ö†Ô∏è Gagal membaca data</p>";
  }
  
});
    function tampilkanIdentitasRestoran(data) {
  const logoContainer = document.getElementById("logoContainer");
  const namaDisplay = document.getElementById("namaRestoranDisplay");

  const identitasContainer = document.createElement("div");
  identitasContainer.id = "identitasContainer";
  identitasContainer.style.textAlign = "center";
  identitasContainer.style.marginBottom = "20px";

  // Logo
  if (data.logo) {
    const img = document.createElement("img");
    img.src = data.logo;
    img.alt = "Logo Resto";
    img.style.maxWidth = "120px";
    img.style.marginBottom = "10px";
    identitasContainer.appendChild(img);
  }

  // Nama Restoran
  if (data.namaRestoran) {
    const nama = document.createElement("h2");
    nama.textContent = data.namaRestoran;
    nama.style.margin = "5px 0";
    identitasContainer.appendChild(nama);
  }

 // Alamat Restoran
if (data.restoAddress) {
  const alamat = document.createElement("p");
  alamat.textContent = data.restoAddress;
  alamat.style.margin = "3px 0";
  alamat.style.fontSize = "14px";
  identitasContainer.appendChild(alamat);
}

// Nomor Telepon
if (data.restoPhone) {
  const telp = document.createElement("p");
  telp.textContent = "Telp: " + data.restoPhone;
  telp.style.margin = "3px 0";
  telp.style.fontSize = "14px";
  identitasContainer.appendChild(telp);
}
  // Tampilkan promo jika ada
if (data.menuPromo && data.menuPromo.length) {
  tampilkanPromo(data.menuPromo);
}
  logoContainer.innerHTML = ""; // Kosongkan dulu
  logoContainer.appendChild(identitasContainer);
}

  function tampilkanPromo(promoList) {
  console.log("MENJALANKAN tampilkanPromo()", promoList);

  const promoContainer = document.getElementById("promo-list");
  if (!promoContainer) {
    console.warn("Elemen promo-list tidak ditemukan di HTML!");
    return;
  }

  promoContainer.innerHTML = "";

  const judul = document.createElement("h3");
  judul.textContent = "üî• Promo Menarik";
  judul.style.textAlign = "center";
  promoContainer.appendChild(judul);

  promoList.forEach((promo, index) => {
  const card = document.createElement("div");
  card.className = "promo-card";
  card.style.border = "1px solid #ccc";
  card.style.borderRadius = "12px";
  card.style.margin = "15px 0";
  card.style.padding = "10px";
  card.style.background = "#fff";
  card.style.boxShadow = "0 2px 8px rgba(0,0,0,0.05)";
  card.style.display = "flex";
  card.style.flexDirection = "column";
  card.style.alignItems = "center";

  const img = document.createElement("img");
  img.src = promo.image;
  img.alt = promo.namaPromo;
  img.style.width = "100%";
  img.style.maxWidth = "300px";
  img.style.borderRadius = "8px";
  img.style.objectFit = "cover";
  img.style.marginBottom = "10px";

  const nama = document.createElement("h4");
  nama.textContent = promo.namaPromo;
  nama.style.margin = "5px 0 5px 0";
  nama.style.textAlign = "center";

  const namaMenu = document.createElement("p");
  namaMenu.textContent = "üçΩ " + (promo.namaMenu || "-");
  namaMenu.style.margin = "0";
  namaMenu.style.fontStyle = "italic";
  namaMenu.style.fontSize = "14px";
  namaMenu.style.textAlign = "center";

  const deskripsi = document.createElement("p");
  deskripsi.textContent = promo.deskripsi || "-";
  deskripsi.style.margin = "5px 0";
  deskripsi.style.fontSize = "13px";
  deskripsi.style.color = "#555";
  deskripsi.style.textAlign = "center";

  const hargaValue = parseInt(promo.hargaPromo || promo.harga || 0);
  const harga = document.createElement("p");
  harga.textContent = "Rp " + hargaValue.toLocaleString();
  harga.style.fontWeight = "bold";
  harga.style.margin = "5px 0";
  harga.style.textAlign = "center";

  // üîÅ Buat tombol - qty +
  const qtyWrapper = document.createElement("div");
  qtyWrapper.className = "qty-wrapper";
  qtyWrapper.style.display = "flex";
  qtyWrapper.style.alignItems = "center";
  qtyWrapper.style.justifyContent = "center";
  qtyWrapper.style.gap = "10px";
  qtyWrapper.style.marginTop = "8px";

  const btnMinus = document.createElement("button");
  btnMinus.textContent = "‚àí";
  btnMinus.style.padding = "4px 12px";
  btnMinus.style.fontSize = "18px";
  btnMinus.style.borderRadius = "5px";
  btnMinus.style.border = "1px solid #888";

  const qtyDisplay = document.createElement("span");
  qtyDisplay.textContent = "0";
  qtyDisplay.dataset.nama = promo.namaPromo;
  qtyDisplay.dataset.harga = hargaValue;
  qtyDisplay.classList.add("qty-promo");
  qtyDisplay.style.fontSize = "16px";
  qtyDisplay.style.minWidth = "20px";
  qtyDisplay.style.textAlign = "center";

  const btnPlus = document.createElement("button");
  btnPlus.textContent = "+";
  btnPlus.style.padding = "4px 12px";
  btnPlus.style.fontSize = "18px";
  btnPlus.style.borderRadius = "5px";
  btnPlus.style.border = "1px solid #888";

  // üîÅ Event listener tombol
  btnMinus.addEventListener("click", () => {
    let currentQty = parseInt(qtyDisplay.textContent);
    if (currentQty > 0) {
      qtyDisplay.textContent = currentQty - 1;
      updatePromoCart(promo.namaPromo, hargaValue, currentQty - 1);
    }
  });

  btnPlus.addEventListener("click", () => {
    let currentQty = parseInt(qtyDisplay.textContent);
    qtyDisplay.textContent = currentQty + 1;
    updatePromoCart(promo.namaPromo, hargaValue, currentQty + 1);
  });

  qtyWrapper.appendChild(btnMinus);
  qtyWrapper.appendChild(qtyDisplay);
  qtyWrapper.appendChild(btnPlus);

  // üß± Susun isi card
  card.appendChild(img);
  card.appendChild(nama);
  card.appendChild(namaMenu);
  card.appendChild(deskripsi);
  card.appendChild(harga);
  card.appendChild(qtyWrapper);

  promoContainer.appendChild(card);
});

function updatePromoCart(namaPromo, harga, qty) {
  let cart = JSON.parse(localStorage.getItem("promoCart") || "[]");

  const index = cart.findIndex((item) => item.nama === namaPromo);

  if (qty === 0 && index !== -1) {
    cart.splice(index, 1);
  } else if (index !== -1) {
    cart[index].qty = qty;
    cart[index].total = harga * qty;
  } else {
    cart.push({ nama: namaPromo, qty, harga, total: harga * qty });
  }

  localStorage.setItem("promoCart", JSON.stringify(cart));
  console.log("‚úÖ promoCart updated:", cart);
}

function tampilkanMenu() {
  const kategoriFilter = document.getElementById("kategoriFilter");
  const menuList = document.getElementById("menu-list");
  const kategoriDipilih = kategoriFilter.value;
  menuList.innerHTML = "";

  if (!data || !data.menu || !Array.isArray(data.menu)) {
    menuList.innerHTML = "<p>‚ö†Ô∏è Menu tidak ditemukan.</p>";
    return;
  }

  const menuFiltered = data.menu.filter(item => {
    return kategoriDipilih === "Semua" || item.kategori === kategoriDipilih;
  });

  if (menuFiltered.length === 0) {
    menuList.innerHTML = "<p>‚ö†Ô∏è Tidak ada menu dalam kategori ini.</p>";
    return;
  }

  menuFiltered.forEach(item => {
    const indexInAll = data.menu.indexOf(item);

    if (pesanan[indexInAll] === undefined) pesanan[indexInAll] = 0;

    const itemEl = document.createElement("div");
    itemEl.className = "menu-item";
    itemEl.innerHTML = `
      <div>
        <div class="menu-name">${item.nama}</div>
        <div>Rp${item.harga.toLocaleString()}</div>
      </div>
      <div class="qty-controls">
        <button onclick="ubahJumlah(${indexInAll}, -1)">‚ûñ</button>
        <span id="qty-${indexInAll}">${pesanan[indexInAll]}</span>
        <button onclick="ubahJumlah(${indexInAll}, 1)">‚ûï</button>
      </div>
    `;
    menuList.appendChild(itemEl);
  });

  updateRingkasan();
}

function ubahJumlah(index, delta) {
  if (!data.menu[index]) return;
  pesanan[index] = Math.max(0, (pesanan[index] || 0) + delta);
  document.getElementById(`qty-${index}`).innerText = pesanan[index];
  updateRingkasan();
}

function updateRingkasan() {
  let totalQty = 0;
  let totalHargaValue = 0;

  Object.entries(pesanan).forEach(([i, jumlah]) => {
    totalQty += jumlah;
    totalHargaValue += jumlah * parseInt(data.menu[i].harga || 0);
  });

  document.getElementById("total-item").innerText = totalQty;
  document.getElementById("total-harga").innerText = totalHargaValue.toLocaleString();
}

function kirimPesanan() {
  const nama = document.getElementById("nama").value.trim();
  const alamat = document.getElementById("alamat").value.trim();
  const waktuAntar = document.getElementById("waktuAntar").value;
  const catatan = document.getElementById("catatan").value.trim();
  const ruangan = document.getElementById("ruangan").value.trim();
  const now = new Date();
  const waktuOrder = now.toLocaleString("id-ID");

  let listPesanan = Object.entries(pesanan)
    .filter(([_, jumlah]) => jumlah > 0)
    .map(([i, jumlah]) => `${data.menu[i].nama} x${jumlah} (Rp${(jumlah * parseInt(data.menu[i].harga)).toLocaleString()})`)
    .join("\n");

  if (!listPesanan) {
    alert("Belum ada item yang dipilih.");
    return;
  }

  let totalHargaAll = Object.entries(pesanan).reduce((sum, [i, jml]) => sum + (jml * parseInt(data.menu[i].harga || 0)), 0);

  let pesanWA = `üßæ Pesanan Baru dari ${nama || "Customer"}\n\n` +
    `üìÖ Tanggal Order: ${waktuOrder}\n` +
    (waktuAntar ? `üïí Waktu Antar: ${new Date(waktuAntar).toLocaleString("id-ID")}\n` : "") +
    (ruangan ? `üè® Ruangan: ${ruangan}\n` : "") +
    `\nüìç Alamat:\n${alamat}\n` +
    `\nüõí Pesanan:\n${listPesanan}\n\n` +
    `üí∞ Total: Rp${totalHargaAll.toLocaleString()}\n` +
    (catatan ? `\nüìå Catatan:\n${catatan}` : "");

  const nomorAdminList = data.nomorWaAdmin || [];

  if (nomorAdminList.length === 0) {
    alert("‚ö†Ô∏è Tidak ada nomor admin yang tersedia.");
    return;
  }

  // Kirim ke semua nomor admin
  nomorAdminList.forEach(nomor => {
    const waLink = `https://wa.me/${nomor}?text=${encodeURIComponent(pesanWA)}`;
    window.open(waLink, "_blank");
  });
}

  </script>
</body>
</html>





















