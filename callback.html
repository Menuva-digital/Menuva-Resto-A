<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Callback Google Login</title>
</head>
<body>
  <h2>Proses Login...</h2>
  <div id="userInfo"></div>
  <button id="toAdmin" style="display:none;" onclick="goAdmin()">Lanjut ke Admin</button>

  <script>
    async function handleCallback() {
      // Ambil hash token dari URL (setelah login Google)
      const params = new URLSearchParams(window.location.hash.substr(1));
      const accessToken = params.get("access_token");

      if (!accessToken) {
        document.getElementById("userInfo").innerText = "Login gagal atau dibatalkan.";
        return;
      }

      // Panggil Google API untuk ambil info user
      try {
        const res = await fetch("https://www.googleapis.com/oauth2/v3/userinfo", {
          headers: { "Authorization": "Bearer " + accessToken }
        });
        const user = await res.json();

        // Tampilkan info user
        document.getElementById("userInfo").innerHTML = `
          <p><b>Login Berhasil!</b></p>
          <p>Nama: ${user.name}</p>
          <p>Email: ${user.email}</p>
          <img src="${user.picture}" width="100" style="border-radius:50%">
        `;

        // Tampilkan tombol lanjut ke admin
        document.getElementById("toAdmin").style.display = "block";

        // Simpan email/token di localStorage agar bisa dipakai di admin.html
        localStorage.setItem("userEmail", user.email);
        localStorage.setItem("accessToken", accessToken);

      } catch (e) {
        document.getElementById("userInfo").innerText = "Gagal mengambil data user.";
      }
    }

    function goAdmin() {
      window.location.href = "admin.html";
    }

    handleCallback();
  </script>
</body>
</html>
